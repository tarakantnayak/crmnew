'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) {
  return typeof obj;
} : function (obj) {
  return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
};

var classCallCheck = function (instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
};

var createClass = function () {
  function defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }

  return function (Constructor, protoProps, staticProps) {
    if (protoProps) defineProperties(Constructor.prototype, protoProps);
    if (staticProps) defineProperties(Constructor, staticProps);
    return Constructor;
  };
}();

window.App.Fields={Date:{months:['JS_JAN','JS_FEB','JS_MAR','JS_APR','JS_MAY','JS_JUN','JS_JUL','JS_AUG','JS_SEP','JS_OCT','JS_NOV','JS_DEC'],monthsTranslated:['JS_JAN','JS_FEB','JS_MAR','JS_APR','JS_MAY','JS_JUN','JS_JUL','JS_AUG','JS_SEP','JS_OCT','JS_NOV','JS_DEC'].map(function(monthName){return app.vtranslate(monthName)}),fullMonths:['JS_JANUARY','JS_FEBRUARY','JS_MARCH','JS_APRIL','JS_MAY','JS_JUNE','JS_JULY','JS_AUGUST','JS_SEPTEMBER','JS_OCTOBER','JS_NOVEMBER','JS_DECEMBER'],fullMonthsTranslated:['JS_JANUARY','JS_FEBRUARY','JS_MARCH','JS_APRIL','JS_MAY','JS_JUNE','JS_JULY','JS_AUGUST','JS_SEPTEMBER','JS_OCTOBER','JS_NOVEMBER','JS_DECEMBER'].map(function(monthName){return app.vtranslate(monthName)}),days:['JS_SUN','JS_MON','JS_TUE','JS_WED','JS_THU','JS_FRI','JS_SAT'],daysTranslated:['JS_SUN','JS_MON','JS_TUE','JS_WED','JS_THU','JS_FRI','JS_SAT'].map(function(monthName){return app.vtranslate(monthName)}),fullDays:['JS_SUNDAY','JS_MONDAY','JS_TUESDAY','JS_WEDNESDAY','JS_THURSDAY','JS_FRIDAY','JS_SATURDAY'],fullDaysTranslated:['JS_SUNDAY','JS_MONDAY','JS_TUESDAY','JS_WEDNESDAY','JS_THURSDAY','JS_FRIDAY','JS_SATURDAY'].map(function(monthName){return app.vtranslate(monthName)}),register:function register(parentElement,registerForAddon,customParams){var className=3<arguments.length&&void 0!==arguments[3]?arguments[3]:'dateField';parentElement='undefined'==typeof parentElement?$('body'):$(parentElement),'undefined'==typeof registerForAddon&&(registerForAddon=!0);var elements=$('.'+className,parentElement);if(parentElement.hasClass(className)&&(elements=parentElement),0!==elements.length){if(!0===registerForAddon){var parentDateElem=elements.closest('.date');$('.js-date__btn',parentDateElem).on('click',function(e){$(e.currentTarget).closest('.date').find('input.'+className).get(0).focus();});}var format=CONFIG.dateFormat,elementDateFormat=elements.data('dateFormat');'undefined'!=typeof elementDateFormat&&(format=elementDateFormat),'undefined'==typeof $.fn.datepicker.dates[CONFIG.langKey]&&($.fn.datepicker.dates[CONFIG.langKey]={days:App.Fields.Date.fullDaysTranslated,daysShort:App.Fields.Date.daysTranslated,daysMin:App.Fields.Date.daysTranslated,months:App.Fields.Date.fullMonthsTranslated,monthsShort:App.Fields.Date.monthsTranslated,today:app.vtranslate('JS_TODAY'),clear:app.vtranslate('JS_CLEAR'),format:format,titleFormat:'MM yyyy',weekStart:CONFIG.firstDayOfWeekNo});var params={todayBtn:'linked',clearBtn:!0,language:CONFIG.langKey,weekStart:CONFIG.firstDayOfWeekNo,autoclose:!0,todayHighlight:!0,format:format};return 'undefined'!=typeof customParams&&(params=$.extend(params,customParams)),elements.each(function(index,element){$(element).datepicker($.extend(!0,Object.assign(params,{enableOnReadonly:!element.hasAttribute('readonly')}),$(element).data('params')));}),App.Fields.Utils.hideMobileKeyboard(elements),elements}},registerRange:function registerRange(parentElement){var _this=this,customParams=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};parentElement='undefined'==typeof parentElement?$('body'):$(parentElement);var elements=$('.dateRangeField',parentElement);if(parentElement.hasClass('dateRangeField')&&(elements=parentElement),0!==elements.length){var format=CONFIG.dateFormat.toUpperCase(),elementDateFormat=elements.data('dateFormat');'undefined'!=typeof elementDateFormat&&(format=elementDateFormat.toUpperCase());var ranges={};ranges[app.vtranslate('JS_TODAY')]=[moment(),moment()],ranges[app.vtranslate('JS_YESTERDAY')]=[moment().subtract(1,'days'),moment().subtract(1,'days')],ranges[app.vtranslate('JS_LAST_7_DAYS')]=[moment().subtract(6,'days'),moment()],ranges[app.vtranslate('JS_CURRENT_MONTH')]=[moment().startOf('month'),moment().endOf('month')],ranges[app.vtranslate('JS_LAST_MONTH')]=[moment().subtract(1,'month').startOf('month'),moment().subtract(1,'month').endOf('month')],ranges[app.vtranslate('JS_LAST_3_MONTHS')]=[moment().subtract(3,'month').startOf('month'),moment().subtract(1,'month').endOf('month')],ranges[app.vtranslate('JS_LAST_6_MONTHS')]=[moment().subtract(6,'month').startOf('month'),moment().subtract(1,'month').endOf('month')];var params={autoUpdateInput:!1,autoApply:!0,ranges:ranges,locale:{format:format,separator:',',applyLabel:app.vtranslate('JS_APPLY'),cancelLabel:app.vtranslate('JS_CANCEL'),fromLabel:app.vtranslate('JS_FROM'),toLabel:app.vtranslate('JS_TO'),customRangeLabel:app.vtranslate('JS_CUSTOM'),weekLabel:app.vtranslate('JS_WEEK').substr(0,1),firstDay:CONFIG.firstDayOfWeekNo,daysOfWeek:App.Fields.Date.daysTranslated,monthNames:App.Fields.Date.fullMonthsTranslated}};'undefined'!=typeof customParams&&(params=$.extend(params,customParams)),parentElement.find('.js-date__btn').off().on('click',function(e){$(e.currentTarget).parent().next('.dateRangeField')[0].focus();}),elements.each(function(index,element){var el=$(element),currentParams=$.extend(!0,params,el.data('params'));el.daterangepicker(currentParams).on('apply.daterangepicker',function(ev,picker){$(this).val(picker.startDate.format(currentParams.locale.format)+','+picker.endDate.format(currentParams.locale.format)),$(this).trigger('change');}).on('show.daterangepicker',function(ev,picker){_this.positionPicker(ev,picker);}).on('showCalendar.daterangepicker',function(ev,picker){_this.positionPicker(ev,picker),picker.container.addClass('js-visible');}).on('hide.daterangepicker',function(ev,picker){picker.container.removeClass('js-visible');}),App.Fields.Utils.registerMobileDateRangePicker(el);});}},positionPicker:function positionPicker(ev,picker){var offset=picker.element.offset(),$window=$(window);picker.opens=offset.left-$window.scrollLeft()+picker.container.outerWidth()>$window.width()?'left':'right',picker.move(),picker.drops=offset.top-$window.scrollTop()+picker.container.outerHeight()>$window.height()?'up':'down',picker.move();}},DateTime:{register:function register(parentElement,customParams){parentElement='undefined'==typeof parentElement?$('body'):$(parentElement);var elements=$('.dateTimePickerField',parentElement);if(parentElement.hasClass('dateTimePickerField')&&(elements=parentElement),0!==elements.length){$('.input-group-text',elements.closest('.dateTime')).on('click',function(e){$(e.currentTarget).closest('.dateTime').find('input.dateTimePickerField ').get(0).focus();});var dateFormat=CONFIG.dateFormat.toUpperCase(),elementDateFormat=elements.data('dateFormat');'undefined'!=typeof elementDateFormat&&(dateFormat=elementDateFormat.toUpperCase());var hourFormat=CONFIG.hourFormat,elementHourFormat=elements.data('hourFormat');'undefined'!=typeof elementHourFormat&&(hourFormat=elementHourFormat);var timePicker24Hour=!0,timeFormat='HH:mm';'24'!=hourFormat&&(timePicker24Hour=!1,timeFormat='hh:mm A');var format=dateFormat+' '+timeFormat,isDateRangePicker='range'!==elements.data('calendarType'),params={parentEl:parentElement,singleDatePicker:isDateRangePicker,showDropdowns:!0,timePicker:!0,autoUpdateInput:!1,timePicker24Hour:timePicker24Hour,timePickerIncrement:1,autoApply:!0,opens:'left',locale:{format:format,separator:',',applyLabel:app.vtranslate('JS_APPLY'),cancelLabel:app.vtranslate('JS_CANCEL'),fromLabel:app.vtranslate('JS_FROM'),toLabel:app.vtranslate('JS_TO'),customRangeLabel:app.vtranslate('JS_CUSTOM'),weekLabel:app.vtranslate('JS_WEEK').substr(0,1),firstDay:CONFIG.firstDayOfWeekNo,daysOfWeek:App.Fields.Date.daysTranslated,monthNames:App.Fields.Date.fullMonthsTranslated}};'undefined'!=typeof customParams&&(params=$.extend(params,customParams)),elements.daterangepicker(params).on('apply.daterangepicker',function(ev,picker){isDateRangePicker?$(this).val(picker.startDate.format(format)):$(this).val(picker.startDate.format(format)+','+picker.endDate.format(format));}),elements.each(function(index,element){App.Fields.Utils.registerMobileDateRangePicker($(element));});}}},Colors:{getColorContrast:function getColorContrast(hexcolor){var r=parseInt(hexcolor.substr(0,2),16),g=parseInt(hexcolor.substr(2,2),16),b=parseInt(hexcolor.substr(4,2),16);return 128<=(299*r+587*g+114*b)/1e3?'light':'dark'},getRandomColor:function getRandomColor(){for(var letters=['0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'],color='#',i=0;6>i;i++)color+=letters[Math.floor(16*Math.random())];return color},getRandomColors:function getRandomColors(count){for(var colors=[],i=0;i<count;i++)colors.push(this.getRandomColor());return colors}},Text:{registerCopyClipboard:function registerCopyClipboard(container){var key=1<arguments.length&&void 0!==arguments[1]?arguments[1]:'.clipboard';if('object'===('undefined'==typeof container?'undefined':_typeof(container))){container=$(container).get(0);var elements=container.querySelectorAll(key);return 0===elements.length&&(elements=key,container=''),new ClipboardJS(elements,{container:container,text:function text(trigger){Vtiger_Helper_Js.showPnotify({text:app.vtranslate('JS_NOTIFY_COPY_TEXT'),type:'success'}),trigger=$(trigger);var element=$(trigger.data('copyTarget'),container),val=void 0;return val='undefined'==typeof trigger.data('copyType')?'undefined'==typeof trigger.data('copy-attribute')?element.val():trigger.data(trigger.data('copy-attribute')):element.is('select')?element.find('option:selected').data(trigger.data('copyType')):element.data(trigger.data('copyType')),val}})}},Editor:function(){function Editor(parentElement,params){classCallCheck(this,Editor);var elements;if(parentElement='undefined'==typeof parentElement?$('body'):$(parentElement),elements=parentElement.hasClass('js-editor')&&!parentElement.prop('disabled')?parentElement:$('.js-editor:not([disabled])',parentElement),0!==elements.length&&'undefined'!=typeof elements)if(this.isModal=elements.closest('.js-modal-container').length,this.isModal){var self=this;this.progressInstance=$.progressIndicator({blockInfo:{enabled:!0,onBlock:function onBlock(){self.loadEditor(elements,params);}}});}else this.loadEditor(elements,params);}return createClass(Editor,[{key:'setElement',value:function setElement(element){return this.element=$(element),this}},{key:'getElement',value:function getElement(){return this.element}},{key:'getElementId',value:function getElementId(){return this.getElement().attr('id')}},{key:'getEditorInstanceFromName',value:function getEditorInstanceFromName(){return CKEDITOR.instances[this.getElementId()]}},{key:'loadEditor',value:function loadEditor(element,customConfig){this.setElement(element);var instance=this.getEditorInstanceFromName(),self=this,config={language:CONFIG.langKey,allowedContent:!0,format_tags:'p;h1;h2;h3;h4;h5;h6;pre;address;div',removeButtons:'',scayt_autoStartup:!1,enterMode:CKEDITOR.ENTER_BR,shiftEnterMode:CKEDITOR.ENTER_P,emojiEnabled:!1,mentionsEnabled:!1,on:{instanceReady:function instanceReady(evt){evt.editor.on('blur',function(){evt.editor.updateElement();}),self.isModal&&self.progressInstance.progressIndicator({mode:'hide'});}},extraPlugins:'colorbutton,pagebreak,colordialog,find,selectall,showblocks,div,print,font,justify,bidi,ckeditor-image-to-base',toolbar:'Full',toolbar_Full:[{name:'clipboard',items:['Cut','Copy','Paste','PasteText','PasteFromWord','-','Undo','Redo']},{name:'editing',items:['Find','Replace','-','SelectAll','-','Scayt']},{name:'links',items:['Link','Unlink']},{name:'insert',items:['ckeditor-image-to-base','Table','HorizontalRule','SpecialChar','PageBreak']},{name:'tools',items:['Maximize','ShowBlocks']},{name:'paragraph',items:['Outdent','Indent','-','Blockquote','CreateDiv']},{name:'document',items:['Source','Print']},'/',{name:'styles',items:['Styles','Format','Font','FontSize']},{name:'basicstyles',items:['Bold','Italic','Underline','Strike','Subscript','Superscript']},{name:'colors',items:['TextColor','BGColor']},{name:'paragraph',items:['NumberedList','BulletedList','-','JustifyLeft','JustifyCenter','JustifyRight','JustifyBlock','-','BidiLtr','BidiRtl']},{name:'basicstyles',items:['CopyFormatting','RemoveFormat']}],toolbar_Min:[{name:'basicstyles',items:['Bold','Italic','Underline','Strike']},{name:'colors',items:['TextColor','BGColor']},{name:'tools',items:['Maximize']},{name:'paragraph',items:['NumberedList','BulletedList','-','JustifyLeft','JustifyCenter','JustifyRight','JustifyBlock','-','BidiLtr','BidiRtl']},{name:'basicstyles',items:['CopyFormatting','RemoveFormat']}],toolbar_Clipboard:[{name:'document',items:['Print']},{name:'basicstyles',items:['CopyFormatting','RemoveFormat']},{name:'clipboard',items:['Cut','Copy','Paste','PasteText','PasteFromWord','-','Undo','Redo']}]};if('undefined'!=typeof customConfig&&(config=$.extend(config,customConfig)),config=Object.assign(config,element.data()),config.emojiEnabled){var emojiToolbar={name:'links',items:['EmojiPanel']};'string'==typeof config.toolbar?config['toolbar_'+config.toolbar].push(emojiToolbar):Array.isArray(config.toolbar)&&config.toolbar.push(emojiToolbar),config.extraPlugins+=',emoji',config.outputTemplate='{id}';}config.mentionsEnabled&&(config.extraPlugins+=',mentions',config.mentions=this.registerMentions()),instance&&CKEDITOR.remove(instance),element.ckeditor(config);}},{key:'registerMentions',value:function registerMentions(){var minSerchTextLength=app.getMainParams('gsMinLength');return [{feed:this.getMentionUsersData.bind(this),itemTemplate:'<li data-id="{id}" class="row no-gutters">\n\t\t\t\t\t\t\t\t\t\t\t<div class="c-img__completion__container">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="{icon} m-auto u-w-fit u-font-size-14px"></div>\n\t\t\t\t\t\t\t\t\t\t\t\t<img src="{image}" class="c-img__completion mr-2" alt="{label}" title="{label}">\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="col row no-gutters u-overflow-x-hidden">\n\t\t\t\t\t\t\t\t\t\t\t\t<strong class="u-text-ellipsis--no-hover col-12">{label}</strong>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="fullname col-12 u-text-ellipsis--no-hover text-muted small">{category}</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</li>',outputTemplate:'<a href="#" data-id="@{id}" data-module="{module}">{label}</a>',minChars:minSerchTextLength},{feed:App.Fields.Text.getMentionData,marker:'#',pattern:/#[wа-я]{1,}|#\w{3,}$/,itemTemplate:'<li data-id="{id}" class="row no-gutters">\n\t\t\t\t\t\t\t\t\t\t\t<div class="col c-circle-icon mr-1">\n\t\t\t\t\t\t\t\t\t\t\t\t<span class="userIcon-{module}"></span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="col row no-gutters u-overflow-x-hidden">\n\t\t\t\t\t\t\t\t\t\t\t\t<strong class="u-text-ellipsis--no-hover col-12">{label}</strong>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="fullname col-12 u-text-ellipsis--no-hover text-muted small">{category}</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</li>',outputTemplate:'<a href="#" data-id="#{id}" data-module="{module}">{label}</a>',minChars:minSerchTextLength}]}},{key:'getMentionUsersData',value:function getMentionUsersData(opts,callback){App.Fields.Text.getMentionData(opts,callback,'owners');}}]),Editor}(),Completions:function(){function Completions(){var inputDiv=0<arguments.length&&void 0!==arguments[0]?arguments[0]:$('.js-completions').eq(0),params=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{emojiPanel:!0};if(classCallCheck(this,Completions),'undefined'!=typeof inputDiv&&0!==inputDiv.length){void 0===inputDiv.length&&(inputDiv=$(inputDiv));this.params=Object.assign({completionsCollection:{records:!0,users:!0,emojis:!0}},inputDiv.data(),params),this.inputDiv=inputDiv,this.collection=[],this.params.completionsCollection.records&&this.collection.push(this.registerMentionCollection('#')),this.params.completionsCollection.users&&this.collection.push(this.registerMentionCollection('@','owners')),this.params.completionsCollection.emojis&&this.collection.push(this.registerEmojiCollection()),this.register(inputDiv);}}return createClass(Completions,[{key:'registerMentionCollection',value:function registerMentionCollection(symbol){var searchModule=1<arguments.length&&void 0!==arguments[1]?arguments[1]:'-',self=this;return {trigger:symbol,selectTemplate:function selectTemplate(item){return this.range.isContentEditable(this.current.element)?'<a href="#" data-id="'+(symbol+item.original.id)+'" data-module="'+item.original.module+'">'+item.original.label.split('(')[0].trim()+'</a>':symbol+item.original.label},values:function values(text,cb){text.length>=CONFIG.globalSearchAutocompleteMinLength&&App.Fields.Text.getMentionData(text,function(users){return cb(users)},searchModule);},menuItemTemplate:function menuItemTemplate(item){return self.mentionTemplate({id:item.original.id,module:item.original.module,category:item.original.category,image:item.original.image,label:item.original.label,icon:item.original.icon})},lookup:'label',fillAttr:'label'}}},{key:'registerEmojiCollection',value:function registerEmojiCollection(){return {trigger:':',selectTemplate:function selectTemplate(item){return this.range.isContentEditable(this.current.element)?'<span data-id="'+item.original.id+'">'+item.original.symbol+'</span>':item.original.symbol},menuItemTemplate:function menuItemTemplate(item){return '<span data-id="'+item.original.id+'">'+item.original.symbol+' '+item.original.id+'</span>'},lookup:'id',fillAttr:'keywords',values:function values(text,cb){2<=text.length&&cb(App.emoji);}}}},{key:'mentionTemplate',value:function mentionTemplate(params){var icon='';void 0!==params.module&&(icon='userIcon-'+params.module),void 0!==params.icon&&''!==params.icon&&(icon=params.icon);var avatar='<div class="col c-circle-icon mr-1">\n\t\t\t\t\t\t\t\t<span class="'+icon+'"></span>\n\t\t\t\t\t\t\t</div>';return void 0!==params.image&&''!==params.image&&(avatar='<div class="c-img__completion__container"><img src="'+params.image+'" class="c-img__completion mr-2" alt='+params.label+'" title="'+params.label+'"></div>'),'<div data-id="'+params.id+'" class="row no-gutters">\n\t\t\t\t\t\t\t'+avatar+'\n\t\t\t\t\t\t\t<div class="col row no-gutters u-overflow-x-hidden">\n\t\t\t\t\t\t\t\t<strong class="u-text-ellipsis--no-hover col-12">'+params.label+'</strong>\n\t\t\t\t\t\t\t\t<div class="fullname col-12 u-text-ellipsis--no-hover text-muted small">'+params.category+'</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>'}},{key:'register',value:function register(inputDiv){var self=this;this.completionsCollection=new Tribute({collection:self.collection,allowSpaces:!0,replaceTextSuffix:''}),this.completionsCollection.attach(inputDiv[0]),void 0!==this.params.completionsTextarea&&this.registerCompletionsTextArea(inputDiv),void 0!==this.params.completionsButtons&&this.registerCompletionsButtons(),this.params.emojiPanel&&this.registerEmojiPanel(this.inputDiv,this.inputDiv.parents().eq(3).find('.js-completions__emojis')),void 0===App.emoji&&fetch(CONFIG.siteUrl+'/vendor/ckeditor/ckeditor/plugins/emoji/emoji.json').then(function(response){return response.json()}).then(function(response){App.emoji=response;}).catch(function(error){return console.error('Error:',error)}),this.registerTagClick(inputDiv);}},{key:'registerCompletionsTextArea',value:function registerCompletionsTextArea(inputDiv){var textarea=inputDiv.siblings('[name='+inputDiv.attr('id')+']');inputDiv.on('focus',function(){textarea.val(inputDiv.html());}).on('blur keyup paste input',function(){textarea.val(inputDiv.html());});}},{key:'registerTagClick',value:function registerTagClick(inputDiv){inputDiv.closest('.js-completions__container').find('.js-completions__messages').on('click','.js-completions__tag',function(e){e.preventDefault(),inputDiv.append($(e.target).clone());});}},{key:'registerCompletionsButtons',value:function registerCompletionsButtons(){var _this2=this,completionsContainer=this.inputDiv.parents().eq(3);completionsContainer.find('.js-completions__users').on('click',function(){_this2.completionsCollection.showMenuForCollection(_this2.inputDiv[0],1);}),completionsContainer.find('.js-completions__records').on('click',function(){_this2.completionsCollection.showMenuForCollection(_this2.inputDiv[0],0);});}},{key:'registerEmojiPanel',value:function registerEmojiPanel(inputDiv,emojisContainer){new EmojiPanel({container:'.js-completions__emojis',json_url:CONFIG.siteUrl+'libraries/emojipanel/dist/emojis.json'}),emojisContainer.on('click',function(e){var element=$(e.target);element.toggleClass('active');}),emojisContainer.on('click','.emoji',function(e){e.preventDefault(),e.stopPropagation(),void 0!==$(e.currentTarget).data('char')&&inputDiv.append(''+$(e.currentTarget).data('char'));}),emojisContainer.on('mouseenter','.emoji',function(e){void 0!==$(e.currentTarget).data('name')&&(emojisContainer.find('.emoji-hovered').remove(),emojisContainer.find('footer').prepend('<div class="emoji-hovered">'+($(e.currentTarget).data('char')+' '+$(e.currentTarget).data('name'))+'</div>'));}),emojisContainer.on('clickoutside',function(){emojisContainer.removeClass('active');});}}]),Completions}(),getMentionData:function getMentionData(text,callback){var searchModule=2<arguments.length&&arguments[2]!==void 0?arguments[2]:'-',basicSearch=new Vtiger_BasicSearch_Js;basicSearch.reduceNumberResults=app.getMainParams('gsAmountResponse'),basicSearch.returnHtml=!1,basicSearch.searchModule=searchModule,'object'===('undefined'==typeof text?'undefined':_typeof(text))&&(text=text.query.toLowerCase()),'owners'===searchModule?AppConnector.request({action:'Search',mode:'owners',value:text}).done(function(data){callback(data.result);}):basicSearch.search(text).done(function(data){data=JSON.parse(data);var serverDataFormat=data.result,reponseDataList=[];for(var id in serverDataFormat){var responseData=serverDataFormat[id];reponseDataList.push(responseData);}callback(reponseDataList);});},destroyEditor:function destroyEditor(element){'undefined'!=typeof CKEDITOR&&CKEDITOR.instances&&element.attr('id')in CKEDITOR.instances&&CKEDITOR.instances[element.attr('id')].destroy();},generateRandomChar:function generateRandomChar(){var rand=Math.floor(Math.random()*'0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ'.length);return '0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ'.substring(rand,rand+1)},generateRandomHash:function generateRandomHash(){var prefix=0<arguments.length&&arguments[0]!==void 0?arguments[0]:'';prefix=prefix.toString();var hash=Math.random().toString(36).substr(2,10)+Math.random().toString(36).substr(2,10)+new Date().valueOf()+Math.random().toString(36).substr(2,6);return prefix?prefix+hash:hash}},Picklist:{changeSelectElementView:function changeSelectElementView(parent,view,viewParams){var _this3=this;if('undefined'==typeof parent&&(parent=$('body')),'undefined'==typeof view){var select2Elements=$('select.select2',parent).toArray();return void select2Elements.forEach(function(elem){_this3.changeSelectElementView($(elem),'select2',viewParams);})}return 'select2'===view?App.Fields.Picklist.showSelect2ElementView(parent,viewParams):void app.errorLog(new Error('Unknown select type ['+view+']'))},showLazySelect:function showLazySelect(selectElement,params){var _this4=this;$.fn.select2.amd.require(['select2/data/array','select2/utils'],function(ArrayData,Utils){function CustomData($element,params){CustomData.__super__.constructor.call(this,$element,params);}Utils.Extend(CustomData,ArrayData),CustomData.prototype.query=function(options,callback){var results=[];results=options.term&&''!==options.term?params.data.filter(function(e){return 0<=e.text.toUpperCase().indexOf(options.term.toUpperCase())}):params.data,'page'in options||(options.page=1);var data={};data.results=results.slice((options.page-1)*params.lazyElements,options.page*params.lazyElements),data.pagination={},data.pagination.more=options.page*params.lazyElements<results.length,callback(data);},params.selectParams=Object.assign(params.selectParams,{ajax:{},dataAdapter:CustomData}),selectElement.removeClass('js-lazy-select'),_this4.showSelect2ElementView(selectElement,params.selectParams);var selectedOption=selectElement.data('selected-value');if(selectedOption){var text=selectedOption;selectElement.data('fieldinfo').picklistvalues.hasOwnProperty(selectedOption)&&(text=selectElement.data('fieldinfo').picklistvalues[selectedOption]);var newOption=new Option(text,selectedOption,!0,!0);selectElement.append(newOption).trigger('change');}});},showSelect2ElementView:function showSelect2ElementView(selectElement,params){var _this5=this,self=this;if(selectElement=$(selectElement),'undefined'==typeof params&&(params={}),1<$(selectElement).length)return $(selectElement).each(function(index,element){_this5.showSelect2ElementView($(element).eq(0),params);});if(selectElement.hasClass('js-lazy-select')){var items=$.map(selectElement.data('fieldinfo').picklistvalues,function(val,key){return {id:key,text:val}});return App.Fields.Picklist.showLazySelect(selectElement,{lazyElements:50,data:items,selectParams:params})}params=this.registerParams(selectElement,params);var computeDropdownHeight=function(e,dropdownContainer){setTimeout(function(){if(!dropdownContainer.find('.select2-dropdown--above').length){var dropdownList=dropdownContainer.find('.select2-results > .select2-results__options'),selectOffsetTop=$(e.currentTarget).offset().top;dropdownList.css({"max-height":$(window).height()-selectOffsetTop-35-(dropdownList.offset().top-selectOffsetTop)});}},100);};return selectElement.each(function(){var select=$(this),htmlBoolParams=select.data('select');'tags'===htmlBoolParams?(params.tags=!0,params.tokenSeparators=[',']):params[htmlBoolParams]=!0,select.select2(params).on('select2:open',function(e){computeDropdownHeight(e,$('.select2-container--open:not(.select2-container--below)')),select.data('unselecting')&&(select.removeData('unselecting'),setTimeout(function(){select.each(function(){$(this).select2('close');});},1));var instance=$(e.currentTarget).data('select2');instance.$dropdown.css('z-index',1000002);}).on('select2:unselect',function(){select.data('unselecting',!0);}),'function'==typeof self[params.selectCb]&&self[params.selectCb](select,params);}),selectElement},registerParams:function registerParams(selectElement,params){if('undefined'==typeof params.dropdownParent){var modalParent=$(selectElement).closest('.modal-body');modalParent.length&&(params.dropdownParent=modalParent);}var data=selectElement.data();null!=data&&(params=$.extend(data,params)),params.language={},params.theme='bootstrap';var width=$(selectElement).data('width');params.width='undefined'==typeof width?'100%':width,params.containerCssClass='form-control w-100';var containerCssClass=selectElement.data('containerCssClass');if('undefined'!=typeof containerCssClass&&(params.containerCssClass+=' '+containerCssClass),params.language.noResults=function(){return app.vtranslate('JS_NO_RESULTS_FOUND')},'undefined'!=typeof params.customSortOptGroup&&params.customSortOptGroup&&($('optgroup',selectElement).each(function(){var optgroup=$(this),options=optgroup.children().toArray().sort(function(a,b){var aText=$(a).text(),bText=$(b).text();return aText<bText?1:-1});$.each(options,function(i,v){optgroup.prepend(v);});}),delete params.customSortOptGroup),'undefined'!=typeof params.maximumSelectionLength&&'undefined'==typeof params.formatSelectionTooBig){var formatSelectionExceeds=function(limit){return app.vtranslate('JS_YOU_CAN_SELECT_ONLY')+' '+limit.maximum+' '+app.vtranslate('JS_ITEMS')};params.language.maximumSelected=formatSelectionExceeds;}return 'undefined'==typeof selectElement.attr('multiple')||params.placeholder?!params.placeholder&&(params.placeholder=app.vtranslate('JS_SELECT_AN_OPTION')):params.placeholder=app.vtranslate('JS_SELECT_SOME_OPTIONS'),'undefined'==typeof params.templateResult?(params.templateResult=function(data,container){data.element&&data.element.className&&$(container).addClass(data.element.className);var actualElement=$(data.element);return 'undefined'!=typeof selectElement.data('showAdditionalIcons')&&actualElement.is('option')?'<div class="js-element__title d-flex justify-content-between" data-js="appendTo"><div class="u-text-ellipsis--no-hover">'+actualElement.text()+'</div></div>':'undefined'==typeof data.name?data.text:'optgroup'==data.type?'<strong>'+data.name+'</strong>':'<span>'+data.name+'</span>'},params.escapeMarkup=function(markup){return markup}):'function'==typeof this[params.templateResult]&&(params.templateResult=this[params.templateResult]),'undefined'==typeof params.templateSelection?params.templateSelection=function(data,container){return data.element&&data.element.className&&$(container).addClass(data.element.className),''===data.text?data.name:data.text}:'function'==typeof this[params.templateSelection]&&(params.templateSelection=this[params.templateSelection]),1===selectElement.data('ajaxSearch')&&(params=this.registerAjaxParams(selectElement,params)),params},registerAjaxParams:function registerAjaxParams(selectElement,params){params.tags=!1,params.language.searching=function(){return app.vtranslate('JS_SEARCHING')},params.language.inputTooShort=function(args){var remainingChars=args.minimum-args.input.length;return app.vtranslate('JS_INPUT_TOO_SHORT').replace('_LENGTH_',remainingChars)},params.language.errorLoading=function(){return app.vtranslate('JS_NO_RESULTS_FOUND')},params.placeholder='',params.ajax={url:selectElement.data('ajaxUrl'),dataType:'json',delay:250,method:'POST',data:function data(params){return {value:params.term,page:params.page}},processResults:function processResults(data){var items=new Array;return !0==data.success&&(selectElement.find('option').each(function(){var currentTarget=$(this);items.push({label:currentTarget.html(),value:currentTarget.val()});}),items=items.concat(data.result.items)),{results:items,pagination:{more:!1}}},cache:!1},params.escapeMarkup=function(markup){if('undefined'!==markup)return markup};var minimumInputLength=3;return 'undefined'!==selectElement.data('minimumInput')&&(minimumInputLength=selectElement.data('minimumInput')),params.minimumInputLength=minimumInputLength,params.templateResult=function(data){return 'undefined'==typeof data.name?data.text:'optgroup'==data.type?'<strong>'+data.name+'</strong>':'<span>'+data.name+'</span>'},params.templateSelection=function(data){return ''===data.text?data.name:data.text},params},prependDataTemplate:function prependDataTemplate(optionData){var template=optionData.text;return void 0!==optionData.id&&''!==optionData.id&&(template=$(optionData.element.dataset.template),void 0!==optionData.element.dataset.state&&('active'===optionData.element.dataset.state?template.find('.js-select-option-event').removeClass(optionData.element.dataset.iconInactive).addClass(optionData.element.dataset.iconActive):template.find('.js-select-option-event').removeClass(optionData.element.dataset.iconActive).addClass(optionData.element.dataset.iconInactive))),template},registerSelectSortable:function registerSelectSortable(select,params){this.sortSelectOptions(select),this.registerSortEvent(select,params.sortableCb);},sortSelectOptions:function sortSelectOptions(select){select.find('option[data-sort-index]').sort(function(a,b){return $(b).data('sort-index')<$(a).data('sort-index')?1:-1}).appendTo(select);},registerSortEvent:function registerSortEvent(select){var cb=1<arguments.length&&arguments[1]!==void 0?arguments[1]:function(){},ul=select.next('.select2-container').first('ul.select2-selection__rendered');ul.sortable({items:'li:not(.select2-search__field)',tolerance:'pointer',stop:function stop(){$(ul.find('.select2-selection__choice').get().reverse()).each(function(){var optionTitle=$(this).attr('title');select.find('option').each(function(){$(this).text()===optionTitle&&select.prepend($(this));});}),cb(select);}});},registerIconsEvents:function registerIconsEvents(selectElement){selectElement.on('select2:selecting',function(event){var currentTarget=$(event.params.args.originalEvent.target);if(currentTarget.hasClass('js-select-option-event')||currentTarget.is('path')){event.preventDefault(),currentTarget.is('path')&&(currentTarget=currentTarget.closest('.js-select-option-event'));var currentElementData=$(event.params.args.data.element).data(),optionElement=$(event.params.args.data.element),progressIndicatorElement=$.progressIndicator({blockInfo:{enabled:!0}});AppConnector.request(currentElementData.url).done(function(data){progressIndicatorElement.progressIndicator({mode:'hide'});var response=data.result;response&&response.result?('active'===optionElement.attr('data-state')?(optionElement.attr('data-state','inactive'),currentTarget.toggleClass(currentElementData.iconActive+' '+currentElementData.iconInactive)):(optionElement.attr('data-state','active'),currentTarget.toggleClass(currentElementData.iconInactive+' '+currentElementData.iconActive)),response.message&&Vtiger_Helper_Js.showPnotify({text:response.message,type:'success'})):response&&response.message&&Vtiger_Helper_Js.showPnotify({text:response.message});}).fail(function(){progressIndicatorElement.progressIndicator({mode:'hide'});});}});}},MultiImage:{currentFileUploads:0,register:function register(container){$('.js-multi-image',container).each(function(){new MultiImage($(this));});}},MultiEmail:{register:function register(container){container.find('.js-multi-email').each(function(index,element){var inputElement=element;$(element).find('.js-email').each(function(index,element){$(element).on('change',function(){App.Fields.MultiEmail.parseToJSON($(inputElement));});}),$(element).find('.js-multi-email-add-item').each(function(index,element){$(element).on('click',function(){App.Fields.MultiEmail.addEmail($(inputElement));});}),$(element).find('.js-remove-item').each(function(index,element){$(element).on('click',function(e){App.Fields.MultiEmail.removeEmail($(e.target),$(inputElement)),App.Fields.MultiEmail.parseToJSON(container);});}),$(element).find('input.js-checkbox').each(function(index,element){$(element).on('change',function(e){App.Fields.MultiEmail.toggleCheckBox($(e.target)),App.Fields.MultiEmail.parseToJSON(container);});});});},parseToJSON:function parseToJSON(element){for(var allFields=$(element).find('[class*=js-multi-email-row]'),arr=[],arrayLength=allFields.length,i=0;i<arrayLength;++i){var inputField=$(allFields[i]).find('input.js-email').eq(0),checkboxField=$(allFields[i]).find('input.js-checkbox').eq(0);''!==inputField.val()&&arr.push({e:$(inputField).val(),o:$(checkboxField).is(':checked')?1:0});}$(element).find('input.js-hidden-email').val(JSON.stringify(arr));},addEmail:function addEmail(container){var newField=container.find('[class*=js-multi-email-row]').eq(0).clone(!1,!1),cnt=container.find('[class*=js-multi-email-row]').length+1;newField.removeClass('js-multi-email-row-1'),newField.addClass('js-multi-email-row-'+cnt),newField.find('input.js-email').val(''),newField.find('input.js-checkbox').removeAttr('checked'),newField.find('label.js-label-checkbox').removeClass('active'),newField.find('span.far').removeClass('fa-check-square').addClass('fa-square'),newField.find('.js-remove-item').eq(0).on('click',function(e){App.Fields.MultiEmail.removeEmail($(e.target),container),App.Fields.MultiEmail.parseToJSON(container);}),newField.find('input.js-checkbox').eq(0).on('change',function(e){App.Fields.MultiEmail.toggleCheckBox($(e.target)),App.Fields.MultiEmail.parseToJSON(container);}),newField.find('input.js-email').eq(0).on('change',function(){App.Fields.MultiEmail.parseToJSON(container);}),newField.insertAfter(container.find('[class*=js-multi-email-row]').last());},removeEmail:function removeEmail(element,container){1<container.find('[class*=js-multi-email-row]').length&&element.closest('[class*=js-multi-email-row]').remove();},toggleCheckBox:function toggleCheckBox(element){element.is(':checked')?element.attr('checked','checked').closest('.js-multi-email__checkbox').find('.js-multi-email__checkbox__icon').removeClass('fa-square').addClass('fa-check-square'):element.removeAttr('checked').closest('.js-multi-email__checkbox').find('.js-multi-email__checkbox__icon').removeClass('fa-check-square').addClass('fa-square');}},MultiDependField:{register:function register(container){container.find('.js-multi-field').each(function(index,element){var inputElement=$(element),fields=inputElement.find('.js-multi-field-val').data('fields');inputElement.find('.js-multi-field-add-item').on('click',function(){App.Fields.MultiDependField.addRow(inputElement,fields);}),App.Fields.MultiDependField.registerRow(inputElement,fields);});},registerRow:function registerRow(inputElement,fields){for(var i in fields)inputElement.find('[name="'+fields[i]+'"]').on('change',function(){App.Fields.MultiDependField.parseToJson(inputElement,fields);});inputElement.find('.js-remove-item').on('click',function(e){App.Fields.MultiDependField.removeRow($(e.target),inputElement),App.Fields.MultiDependField.parseToJson(inputElement.closest('.js-multi-field'),fields);});},removeRow:function removeRow(element,container){1<container.find('.js-multi-field-row').length&&element.closest('.js-multi-field-row').remove();},parseToJson:function parseToJson(element,fields){for(var arr=[],allFields=$(element).find('.js-multi-field-row'),arrayLength=allFields.length,i=0;i<arrayLength;++i){var partData={},skip=!1;for(var k in fields)if(partData[fields[k]]=$(allFields[i]).find('[name="'+fields[k]+'"]').val(),0==k&&''===partData[fields[k]]){skip=!0;break}skip||arr.push(partData);}$(element).find('input.js-multi-field-val').val(JSON.stringify(arr));},addRow:function addRow(container,fields){var newField=void 0,lastField=container.find('.js-multi-field-row').last(),selectFields=lastField.find('select.select2');for(var i in selectFields.length?(selectFields.select2('destroy').removeAttr('data-select2-id').find('option').removeAttr('data-select2-id'),newField=lastField.clone(!1,!1),App.Fields.Picklist.showSelect2ElementView(lastField.find('select.select2'))):newField=lastField.clone(!1,!1),fields)newField.find('[name="'+fields[i]+'"]').val('');newField.insertAfter(container.find('.js-multi-field-row').last()),App.Fields.Picklist.showSelect2ElementView(newField.find('select.select2')),App.Fields.Date.register(newField),App.Fields.MultiDependField.registerRow(container,fields);}},DependentSelect:{generateOptionsFromData:function generateOptionsFromData(data){var html='',_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=data[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var item=_step.value,selected=!1;'undefined'!=typeof item.selected&&item.selected&&(selected=!0),html+='<option value='+item.value+(selected?' selected':'')+'>'+item.text+'</option>';}}catch(err){_didIteratorError=!0,_iteratorError=err;}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return();}finally{if(_didIteratorError)throw _iteratorError}}return html},register:function register(container){return 'undefined'!=typeof container&&'undefined'!=typeof container.length&&container.length?void container.each(function(){var masterSelect=$(this),slaveSelect=$(masterSelect.data('slave')),data=masterSelect.data('data');return slaveSelect.length?data?void(masterSelect.on('change',function(e){var values=$(e.target).val();Array.isArray(values)||(values=[values]);var children=[],_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=values[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var value=_step2.value,_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,item,_iterator3=data[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0)item=_step3.value,item.value===value&&'undefined'!=typeof item.children&&item.children.forEach(function(child){children.push(child);});}catch(err){_didIteratorError3=!0,_iteratorError3=err;}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return();}finally{if(_didIteratorError3)throw _iteratorError3}}}}catch(err){_didIteratorError2=!0,_iteratorError2=err;}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return();}finally{if(_didIteratorError2)throw _iteratorError2}}masterSelect.data('sort')&&children.sort(function(a,b){return a.text.localeCompare(b.text)}),slaveSelect.html(App.Fields.DependentSelect.generateOptionsFromData(children));}),masterSelect.html(App.Fields.DependentSelect.generateOptionsFromData(data))):app.errorLog('Could not load data (data-data attribute)'):app.errorLog('Could not find slave select element (data-slave attribute)')}):app.errorLog('Dependend select field container is missing.')}},Gantt:{register:function register(container,data){return new GanttField(container,data)}},Integer:{formatToDisplay:function formatToDisplay(value){value||(value=0);var groupSeparator=CONFIG.currencyGroupingSeparator,groupingPattern=CONFIG.currencyGroupingPattern;value=parseFloat(value).toFixed(1);var integer=value.toString().split('.')[0];return 3<integer.length&&('123,456,789'===groupingPattern?integer=integer.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,'$1'+groupSeparator):'123456,789'===groupingPattern?integer=integer.slice(0,-3)+groupSeparator+integer.slice(-3):'12,34,56,789'===groupingPattern&&(integer=integer.slice(0,-3).replace(/(\d)(?=(\d\d)+(?!\d))/g,'$1'+groupSeparator)+groupSeparator+integer.slice(-3))),integer}},Double:{formatToDisplay:function formatToDisplay(value){var fixed=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],numberOfDecimal=2<arguments.length&&arguments[2]!==void 0?arguments[2]:CONFIG.noOfCurrencyDecimals;value||(value=0);var strDecimal=value.toString().split('.')[1],numberOfZerosAtTheEnd=0;if('undefined'!=typeof strDecimal)for(var i=strDecimal.length-1;0<i&&'0'==strDecimal[i];--i)numberOfZerosAtTheEnd++;value=parseFloat(value),fixed&&(value=value.toFixed(numberOfDecimal));var splittedFloat=value.toString().split('.'),integer=App.Fields.Integer.formatToDisplay(splittedFloat[0]),decimal=splittedFloat[1];if(numberOfDecimal){if(!CONFIG.truncateTrailingZeros&&decimal)for(var _i=0;_i<numberOfZerosAtTheEnd&&decimal.length<numberOfDecimal;++_i)decimal+='0';if(decimal)return integer+CONFIG.currencyDecimalSeparator+decimal}return integer},formatToDb:function formatToDb(value){return (null==value||''==value)&&(value=0),value=value.toString(),value=value.split(CONFIG.currencyGroupingSeparator).join(''),value=value.replace(/\s/g,'').replace(CONFIG.currencyDecimalSeparator,'.'),parseFloat(value)}},Tree:{register:function register(container){container.on('click','.js-tree-modal',function(e){var element=$(e.target),parentElem=element.closest('.js-tree-container'),sourceFieldElement=parentElem.find('input[class="sourceField"]'),fieldDisplayElement=parentElem.find('input[name="'+sourceFieldElement.attr('name')+'_display"]');AppConnector.request({module:sourceFieldElement.data('modulename'),view:'TreeModal',template:sourceFieldElement.data('treetemplate'),fieldName:sourceFieldElement.attr('name'),multiple:sourceFieldElement.data('multiple'),value:sourceFieldElement.val()}).done(function(requestData){app.modalEvents.treeModal=function(modal,instance){instance.setSelectEvent(function(responseData){sourceFieldElement.val(responseData.id),fieldDisplayElement.val(responseData.name).attr('readonly',!0);});},app.showModalWindow(requestData,{modalId:'treeModal'});});});}},TimePeriod:function(){function TimePeriod(container){if(classCallCheck(this,TimePeriod),this.container=container,this.value=container.val(),this.value){var split=this.value.split(':');this.time=Number(split[0]),this.period=split[1];}else this.time=0,this.period='H',this.value='0:H',container.val(this.value);this.injectContent();}return createClass(TimePeriod,[{key:'injectContent',value:function injectContent(){var content='<div class="input-group c-time-period" data-js="container">\n\t\t\t\t<div class="input-group-prepend">\n\t\t\t\t\t<a href class="btn btn-default c-time-period-input-modifier c-time-period-input-modifier--minus-1"><span class="fas fa-minus"></span></a>\n\t\t\t\t</div>\n\t\t\t\t<input type="number" class="form-control c-time-period-input" min="0" value="'+this.time+'"\n\t\t\t\t\tdata-validation-engine="validate[required,funcCall[Vtiger_Integer_Validator_Js.invokeValidation]]">\n\t\t\t\t<div class="input-group-append">\n\t\t\t\t\t<a href class="btn btn-default c-time-period-input-modifier c-time-period-input-modifier--plus-1"><span class="fas fa-plus"></span></a>\n\t\t\t\t\t<select class="select2 js-time-period-select time-period-'+this.container.attr('name')+'">\n\t\t\t\t\t\t<option value="d"'+('d'===this.period?' selected="selected"':'')+'>'+app.vtranslate('JS_DAYS_FULL')+'</option>\n\t\t\t\t\t\t<option value="H"'+('H'===this.period?' selected="selected"':'')+'>'+app.vtranslate('JS_HOURS_FULL')+'</option>\n\t\t\t\t\t\t<option value="i"'+('i'===this.period?' selected="selected"':'')+'>'+app.vtranslate('JS_MINUTES_FULL')+'</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t</div>';return this.element=this.container.parent().append(content),this.input=this.element.find('.c-time-period-input').eq(0),this.select=this.element.find('.select2').eq(0),this.plus1btn=this.element.find('.c-time-period-input-modifier--plus-1').eq(0),this.minus1btn=this.element.find('.c-time-period-input-modifier--minus-1').eq(0),App.Fields.Picklist.showSelect2ElementView(this.select,{width:'100px'}),this.registerEvents(),this.element}},{key:'registerEvents',value:function registerEvents(){this.input.on('input',this.onChange.bind(this)),this.select.on('change',this.onChange.bind(this)),this.plus1btn.on('click',this.onPlus1Click.bind(this)),this.minus1btn.on('click',this.onMinus1Click.bind(this));}},{key:'onChange',value:function onChange(){this.time=this.input.val(),this.period=this.select.val(),this.value=this.input.val()+':'+this.select.val(),this.container.val(this.value);}},{key:'onPlus1Click',value:function onPlus1Click(event){event.preventDefault(),event.stopPropagation(),this.input.val(Number(this.input.val())+1),this.onChange();}},{key:'onMinus1Click',value:function onMinus1Click(event){event.preventDefault(),event.stopPropagation(),0<Number(this.input.val())&&(this.input.val(Number(this.input.val())-1),this.onChange());}}],[{key:'register',value:function register(container){if(container.hasClass('c-time-period'))return new TimePeriod(container);var instances=[];return container.find('.c-time-period').each(function(index,value){instances.push(new TimePeriod($(value)));}),instances}}]),TimePeriod}(),MultiCurrency:function(){function MultiCurrency(container){classCallCheck(this,MultiCurrency),this.container=container,this.init();}return createClass(MultiCurrency,[{key:'init',value:function init(){var _this6=this;$('.js-multicurrency-event',this.container).off('click').on('click',function(){var modal=$('<form>').append(_this6.container.find('.js-currencies-container .js-currencies-modal').clone());_this6.registerEnableCurrencyEvent(modal),_this6.registerResetCurrencyEvent(modal),_this6.loadData(modal),_this6.calculateConversionRate(modal),app.showModalWindow({data:modal,css:{},cb:function cb(data){var form=data.parent();form.validationEngine(app.validationEngineOptionsForRecord),form.on('submit',function(e){if(e.preventDefault(),form.validationEngine('validate')&&_this6.saveCurrencies(form)){var id=form.closest('.js-modal-container').attr('id');app.hideModalWindow(null,id);}});}});}),this.getField().on('focusout',function(e){var element=$(e.currentTarget);element.formatNumber(),_this6.setPrice(element.val());});}},{key:'loadData',value:function loadData(modalContainer){var values=JSON.parse(this.getFieldToSave().val()),baseCurrencyId=values.currencyId||CONFIG.currencyId;for(var i in void 0===values.currencies&&(values.currencies=[],values.currencies[baseCurrencyId]={price:0}),values.currencies){var row=modalContainer.find('[data-currency-id="'+i+'"]');row.length&&(row.find('.js-enable-currency').prop('checked',!0),row.find('.js-currency-reset,.js-base-currency,[name^="currencies["]').prop('disabled',!1),row.find('.js-converted-price').val(values.currencies[i].price),i==baseCurrencyId&&row.find('.js-base-currency').prop('checked',!0));}}},{key:'setPrice',value:function setPrice(value){var values=JSON.parse(this.getFieldToSave().val()),baseCurrencyId=values.currencyId||CONFIG.currencyId;values.currencies=values.currencies||{},values.currencies[baseCurrencyId]={price:value},values.currencyId=baseCurrencyId,values=$.extend({},values),this.getFieldToSave().val(JSON.stringify($.extend({},values)));}},{key:'getField',value:function getField(){return this.container.find('.js-multicurrency-field')}},{key:'getFieldToSave',value:function getFieldToSave(){return this.container.find('.js-multicurrency-field-to-save')}},{key:'saveCurrencies',value:function saveCurrencies(modalContainer){var enabledBaseCurrency=modalContainer.find('.js-enable-currency').filter(':checked');if(1>enabledBaseCurrency.length)return Vtiger_Helper_Js.showMessage({text:app.vtranslate('JS_PLEASE_SELECT_BASE_CURRENCY_FOR_PRODUCT'),type:'error'}),!1;var selectedBaseCurrency=modalContainer.find('.js-base-currency').filter(':checked');if(1>selectedBaseCurrency.length)return Vtiger_Helper_Js.showMessage({text:app.vtranslate('JS_PLEASE_ENABLE_BASE_CURRENCY_FOR_PRODUCT'),type:'error'}),!1;var selectedRow=selectedBaseCurrency.closest('tr'),symbol=selectedRow.data('currency-symbol');this.container.find('.js-currency').text(symbol);var data={};return data.currencies={},enabledBaseCurrency.closest('tr').each(function(n,e){var row=$(e),currencyId=row.data('currencyId');data.currencies[currencyId]={},data.currencies[currencyId].price=row.find('.js-converted-price').val(),row.find('.js-base-currency:checked').length&&(data.currencyId=currencyId);}),this.getFieldToSave().val(JSON.stringify(data)),this.getField().val(selectedRow.find('.js-converted-price').val()),selectedBaseCurrency.prop('checked',!1),!0}},{key:'calculateConversionRate',value:function calculateConversionRate(container){var baseCurrencyConversionRate=container.find('.js-base-currency').filter(':checked').closest('tr').find('.js-conversion-rate');if('1'!=baseCurrencyConversionRate.val()){var baseCurrencyRatePrevValue=baseCurrencyConversionRate.getNumberFromValue();container.find('.js-conversion-rate').each(function(key,domElement){var element=$(domElement);element.is(baseCurrencyConversionRate)||element.val(App.Fields.Double.formatToDisplay(element.getNumberFromValue()/baseCurrencyRatePrevValue,!1));}),baseCurrencyConversionRate.val('1');}}},{key:'registerEnableCurrencyEvent',value:function registerEnableCurrencyEvent(container){var _this7=this;container.on('change','.js-enable-currency',function(e){var element=$(e.currentTarget),parentRow=element.closest('tr');if(element.is(':checked')){element.attr('checked','checked');var price=_this7.getField().getNumberFromValue()*parentRow.find('.js-conversion-rate').getNumberFromValue();$('input',parentRow).removeAttr('disabled'),parentRow.find('.js-currency-reset').removeAttr('disabled'),parentRow.find('.js-converted-price').val(App.Fields.Double.formatToDisplay(price));}else{if(parentRow.find('.js-base-currency').is(':checked'))return Vtiger_Helper_Js.showPnotify({type:'error',title:'"'+parentRow.find('.js-currency-name').text()+'" '+app.vtranslate('JS_BASE_CURRENCY_CHANGED_TO_DISABLE_CURRENCY')}),void element.prop('checked',!0);parentRow.find('input').attr('disabled','disabled'),parentRow.find('.js-currency-reset').attr('disabled','disabled'),element.removeAttr('disabled checked');}});}},{key:'registerResetCurrencyEvent',value:function registerResetCurrencyEvent(container){var _this8=this;container.on('click','.js-currency-reset',function(e){var parentElem=$(e.currentTarget).closest('tr'),price=_this8.getField().getNumberFromValue()*parentElem.find('.js-conversion-rate').getNumberFromValue();$('.js-converted-price',parentElem).val(App.Fields.Double.formatToDisplay(price));});}}],[{key:'register',value:function register(container){if(container.hasClass('js-multicurrency-container'))return new MultiCurrency(container);var instances=[];return container.find('.js-multicurrency-container').each(function(n,e){instances.push(new MultiCurrency($(e)));}),instances}}]),MultiCurrency}(),Utils:{registerMobileDateRangePicker:function registerMobileDateRangePicker(element){this.hideMobileKeyboard(element),$(window).width()<app.breakpoints.sm&&element.on('showCalendar.daterangepicker',function(ev,picker){picker.container.addClass('js-visible');}).on('hide.daterangepicker',function(ev,picker){picker.container.removeClass('js-visible');});},hideMobileKeyboard:function hideMobileKeyboard(element){$(window).width()<app.breakpoints.sm&&element.attr('readonly','true').addClass('bg-white');}}};
//# sourceMappingURL=Fields.min.js.map
