{"version":3,"file":"RelatedList.min.js","sources":["RelatedList.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nVtiger_RelatedList_Js(\"Campaigns_RelatedList_Js\", {\n\t/*\n\t * function to trigger send Email\n\t * @params: send email url , module name.\n\t */\n\ttriggerSendEmail: function () {\n\t\tVtiger_List_Js.triggerSendEmail({\n\t\t\trelatedLoad: true,\n\t\t\tsourceModule: app.getModuleName(),\n\t\t\tsourceRecord: app.getRecordId(),\n\t\t\tmodule: jQuery('.relatedModuleName').val(),\n\t\t\tcvid: jQuery('#recordsFilter').val(),\n\t\t});\n\t}\n}, {\n\tgetCompleteParams: function () {\n\t\tvar params = this._super();\n\t\tvar container = this.getRelatedContainer();\n\t\tparams['selectedIds'] = container.find('#selectedIds').data('selectedIds');\n\t\tparams['excludedIds'] = container.find('#excludedIds').data('excludedIds');\n\t\treturn params;\n\t},\n\tchangeCustomFilterElementView: function () {\n\t\tvar filterSelectElement = this.content.find('#recordsFilter');\n\t\tif (filterSelectElement.length > 0) {\n\t\t\tApp.Fields.Picklist.showSelect2ElementView(filterSelectElement, {\n\t\t\t\ttemplateSelection: function (data) {\n\t\t\t\t\tvar resultContainer = jQuery('<span></span>');\n\t\t\t\t\tresultContainer.append(jQuery(jQuery('.filterImage').detach().get(0)).show());\n\t\t\t\t\tresultContainer.append(data.text);\n\t\t\t\t\treturn resultContainer;\n\t\t\t\t},\n\t\t\t\tcustomSortOptGroup: true,\n\t\t\t\tcloseOnSelect: true\n\t\t\t});\n\t\t\tvar select2Instance = filterSelectElement.data('select2');\n\t\t\tselect2Instance.$dropdown.append(this.content.find('span.filterActionsDiv'));\n\t\t}\n\t},\n\tregisterChangeCustomFilterEvent: function () {\n\t\tvar thisInstance = this;\n\t\tvar relatedContainer = thisInstance.getRelatedContainer();\n\t\tvar filterSelectElement = relatedContainer.find('.loadFormFilterButton');\n\t\tvar recordsFilter = relatedContainer.find('#recordsFilter');\n\t\tfilterSelectElement.on('click', function (e) {\n\t\t\tvar message = app.vtranslate('JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_ADD_THIS_FILTER');\n\t\t\tVtiger_Helper_Js.showConfirmationBox({'message': message}).done(function () {\n\t\t\t\tvar cvId = recordsFilter.val();\n\t\t\t\tvar relatedModuleName = relatedContainer.find('.relatedModuleName').val();\n\t\t\t\tvar params = {\n\t\t\t\t\tsourceRecord: app.getRecordId(),\n\t\t\t\t\trelatedModule: relatedModuleName,\n\t\t\t\t\tviewId: cvId,\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\taction: \"RelationAjax\",\n\t\t\t\t\tmode: 'addRelationsFromRelatedModuleViewId'\n\t\t\t\t};\n\t\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\t\tposition: 'html',\n\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\tenabled: true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tAppConnector.request(params).done(function (responseData) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({mode: 'hide'});\n\t\t\t\t\tif (responseData.result === false) {\n\t\t\t\t\t\tvar message = app.vtranslate('JS_NO_RECORDS_RELATED_TO_THIS_FILTER');\n\t\t\t\t\t\tvar params = {\n\t\t\t\t\t\t\ttext: message,\n\t\t\t\t\t\t\ttype: 'info'\n\t\t\t\t\t\t};\n\t\t\t\t\t\tVtiger_Helper_Js.showMessage(params);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tVtiger_Detail_Js.reloadRelatedList();\n\t\t\t\t\t}\n\t\t\t\t}).fail(function () {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({mode: 'hide'});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t},\n\t/**\n\t * Function to edit related status for email enabled modules of campaigns\n\t */\n\tregisterEventToEditRelatedStatus: function () {\n\t\tvar thisInstance = this;\n\t\tvar relatedContainer = thisInstance.getRelatedContainer();\n\t\trelatedContainer.find('.currentStatus').on('click', function (e) {\n\t\t\te.stopImmediatePropagation();\n\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\telement.addClass('open');\n\t\t});\n\t\tvar statusDropdown = relatedContainer.find('.currentStatus').find('.dropdown-menu');\n\t\tstatusDropdown.on('click', 'a', function (e) {\n\t\t\te.stopImmediatePropagation();\n\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\tvar liContainer = element.closest('li');\n\t\t\tvar currentStatus = element.closest('.currentStatus');\n\t\t\tvar selectedStatusId = liContainer.attr('id');\n\t\t\tvar selectedStatusValue = liContainer.data('status');\n\t\t\tvar relatedRecordId = element.closest('tr').data('id');\n\t\t\tvar params = {\n\t\t\t\t'relatedModule': thisInstance.relatedModulename,\n\t\t\t\t'relatedRecord': relatedRecordId,\n\t\t\t\t'status': selectedStatusId,\n\t\t\t\t'module': app.getModuleName(),\n\t\t\t\t'action': 'RelationAjax',\n\t\t\t\t'sourceRecord': thisInstance.parentRecordId,\n\t\t\t\t'mode': 'updateStatus'\n\t\t\t};\n\t\t\telement.progressIndicator();\n\t\t\tAppConnector.request(params).done(function (responseData) {\n\t\t\t\tif (responseData.result[0]) {\n\t\t\t\t\telement.progressIndicator({'mode': 'hide'});\n\t\t\t\t\tcurrentStatus.find('.statusValue').text(selectedStatusValue);\n\t\t\t\t\tcurrentStatus.removeClass('open');\n\t\t\t\t}\n\t\t\t}).fail(function () {\n\t\t\t\telement.progressIndicator({mode: 'hide'});\n\t\t\t});\n\t\t});\n\t},\n\tregisterPostLoadEvents: function () {\n\t\tthis._super();\n\t\tthis.changeCustomFilterElementView();\n\t\tthis.registerChangeCustomFilterEvent();\n\t\tthis.registerEventToEditRelatedStatus();\n\t}\n});\n"],"names":["Vtiger_RelatedList_Js","triggerSendEmail","Vtiger_List_Js","relatedLoad","sourceModule","app","getModuleName","sourceRecord","getRecordId","module","jQuery","val","cvid","getCompleteParams","_super","container","getRelatedContainer","find","data","params","changeCustomFilterElementView","content","length","App","Fields","Picklist","showSelect2ElementView","filterSelectElement","templateSelection","append","detach","get","show","resultContainer","text","customSortOptGroup","closeOnSelect","select2Instance","$dropdown","registerChangeCustomFilterEvent","relatedContainer","thisInstance","recordsFilter","on","vtranslate","Vtiger_Helper_Js","showConfirmationBox","message","done","relatedModuleName","relatedModule","viewId","cvId","action","mode","progressIndicatorElement","progressIndicator","position","blockInfo","enabled","AppConnector","request","responseData","result","showMessage","type","reloadRelatedList","fail","registerEventToEditRelatedStatus","e","stopImmediatePropagation","currentTarget","element","addClass","statusDropdown","liContainer","closest","currentStatus","selectedStatusId","attr","selectedStatusValue","relatedRecordId","relatedModulename","parentRecordId","removeClass","registerPostLoadEvents"],"mappings":"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"}