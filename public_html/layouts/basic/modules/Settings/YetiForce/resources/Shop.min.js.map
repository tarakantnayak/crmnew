{"version":3,"file":"Shop.min.js","sources":["Shop.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n/**\n * Class Settings_YetiForce_Shop_Js.\n * @type {window.Settings_YetiForce_Shop_Js}\n */\nwindow.Settings_YetiForce_Shop_Js = class Settings_YetiForce_Shop_Js {\n\t/**\n\t * Constructor.\n\t */\n\tconstructor(modalUrl = 'index.php?module=YetiForce&parent=Settings') {\n\t\tthis.container = $('.js-products-container');\n\t\tthis.modalUrl = modalUrl;\n\t}\n\t/**\n\t * Register events.\n\t */\n\tregisterEvents() {\n\t\tthis.registerProductModalClick();\n\t\tthis.registerBuyModalClick();\n\t\tthis.registerShopSearch();\n\t\tthis.showInitialModal();\n\t}\n\tshowInitialModal() {\n\t\tlet request = {};\n\t\twindow.location.href.split('&').forEach(el => {\n\t\t\tif (el.includes('=')) {\n\t\t\t\tlet values = el.split('=');\n\t\t\t\trequest[values[0]] = values[1];\n\t\t\t}\n\t\t});\n\t\tif (request.mode) {\n\t\t\tif (request.showBuyModal === 'buy') {\n\t\t\t\tthis.showBuyModal(request.product, request.department);\n\t\t\t} else if (request.mode === 'showProductModal') {\n\t\t\t\tthis.showProductModal(request.product, request.department);\n\t\t\t}\n\t\t}\n\t}\n\t/**\n\t * Register events.\n\t */\n\tregisterShopSearch() {\n\t\tlet searchField = this.container.find('.js-shop-search');\n\t\tsearchField = searchField.length ? searchField : $('.js-shop-search');\n\t\tsearchField\n\t\t\t.on('keyup', e => {\n\t\t\t\tlet value = $(e.currentTarget)\n\t\t\t\t\t.val()\n\t\t\t\t\t.toLowerCase();\n\t\t\t\tthis.container.find('.js-product .js-text-search').filter(function() {\n\t\t\t\t\tlet item = $(this).closest('.js-product');\n\t\t\t\t\tif (\n\t\t\t\t\t\t$(this)\n\t\t\t\t\t\t\t.text()\n\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t.indexOf(value) > -1\n\t\t\t\t\t) {\n\t\t\t\t\t\titem.removeClass('d-none');\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem.addClass('d-none');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t})\n\t\t\t.on('click', e => {\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\t}\n\t/**\n\t * Register product modal click.\n\t *\n\t */\n\tregisterProductModalClick() {\n\t\tthis.container.find('.js-product').on('click', e => {\n\t\t\tconst currentTarget = $(e.currentTarget);\n\t\t\tthis.showProductModal(currentTarget.data('product'), this.getDepartment(currentTarget));\n\t\t});\n\t}\n\t/**\n\t * Show product modal action.\n\t *\n\t * @param   {string}  productName\n\t * @param   {string}  department\n\t */\n\tshowProductModal(productName, department) {\n\t\tapp.showModalWindow(\n\t\t\tnull,\n\t\t\t`${this.modalUrl}&view=ProductModal&product=${productName}${department ? '&department=' + department : ''}`,\n\t\t\tmodalContainer => {\n\t\t\t\tmodalContainer.find('.js-modal__save').on('click', _ => {\n\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\tthis.showBuyModal(productName, department);\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t}\n\t/**\n\t * Register buy modal click.\n\t *\n\t */\n\tregisterBuyModalClick() {\n\t\tthis.container.find('.js-buy-modal').on('click', e => {\n\t\t\te.stopPropagation();\n\t\t\tconst currentTarget = $(e.currentTarget);\n\t\t\tthis.showBuyModal(currentTarget.data('product'), this.getDepartment(currentTarget));\n\t\t});\n\t}\n\t/**\n\t * Show buy modal action.\n\t *\n\t * @param   {string}  productName\n\t * @param   {string}  department\n\t */\n\tshowBuyModal(productName, department) {\n\t\tapp.showModalWindow(\n\t\t\tnull,\n\t\t\t`${this.modalUrl}&view=BuyModal&product=${productName}${department ? '&department=' + department : ''}`,\n\t\t\tthis.registerBuyModalEvents.bind(this)\n\t\t);\n\t}\n\n\tregisterBuyModalEvents(modalContainer) {\n\t\tconst companyForm = modalContainer.find('.js-update-company-form');\n\t\tconst buyForm = modalContainer.find('.js-buy-form');\n\t\tmodalContainer.find('.js-modal__save').on('click', _ => {\n\t\t\tthis.registerBuyModalForms(companyForm, buyForm);\n\t\t});\n\t\tif (companyForm.length) {\n\t\t\tcompanyForm.validationEngine(app.validationEngineOptions);\n\t\t\tcompanyForm.find('[data-inputmask]').inputmask();\n\t\t}\n\t\tif (buyForm.length) {\n\t\t\tbuyForm.validationEngine(app.validationEngineOptions);\n\t\t}\n\t}\n\tregisterBuyModalForms(companyForm, buyForm) {\n\t\tif (companyForm.length) {\n\t\t\tif (companyForm.validationEngine('validate') === true) {\n\t\t\t\tapp.removeEmptyFilesInput(companyForm[0]);\n\t\t\t\tconst formData = new FormData(companyForm[0]);\n\t\t\t\tconst params = {\n\t\t\t\t\turl: 'index.php',\n\t\t\t\t\ttype: 'POST',\n\t\t\t\t\tdata: formData,\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tcontentType: false\n\t\t\t\t};\n\t\t\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\t\t\tblockInfo: { enabled: true }\n\t\t\t\t});\n\t\t\t\tAppConnector.request(params).done(data => {\n\t\t\t\t\tif (data.success) {\n\t\t\t\t\t\tbuyForm.submit();\n\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t}\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tapp.formAlignmentAfterValidation(companyForm);\n\t\t\t}\n\t\t} else {\n\t\t\tif (buyForm.validationEngine('validate') === true) {\n\t\t\t\tthis.updateCustomData(buyForm);\n\t\t\t\tbuyForm.submit();\n\t\t\t\tapp.hideModalWindow();\n\t\t\t} else {\n\t\t\t\tapp.formAlignmentAfterValidation(buyForm);\n\t\t\t}\n\t\t}\n\t}\n\t/**\n\t * Update custom data.\n\t */\n\tupdateCustomData(buyForm) {\n\t\tlet customField = buyForm.find('.js-custom-data');\n\t\tlet priceBySize = buyForm.find('.js-price-by-size');\n\t\tif (customField.length) {\n\t\t\tlet customFields = buyForm.find('.js-custom-field');\n\t\t\tcustomFields.each((i, el) => {\n\t\t\t\tlet field = $(el);\n\t\t\t\tcustomField.val(\n\t\t\t\t\t`${customField.val()}${field.data('name')}::${field.val()}${customFields.length - 1 !== i ? '|' : ''}`\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t\tif (priceBySize.length) {\n\t\t\tpriceBySize\n\t\t\t\t.siblings('.js-price-by-size-input')\n\t\t\t\t.val(priceBySize.find(`option[value=\"${priceBySize.val()}\"]`).data('os0'));\n\t\t}\n\t}\n\t/**\n\t * Get department.\n\t *\n\t * @param   {object}  element  jQuery\n\t *\n\t * @return  {string}\n\t */\n\tgetDepartment(element) {\n\t\tlet department = element.closest('.js-department');\n\t\treturn department.length ? department.data('department') : '';\n\t}\n};\n"],"names":["window","Settings_YetiForce_Shop_Js","container","$","modalUrl","registerProductModalClick","registerBuyModalClick","registerShopSearch","showInitialModal","location","href","split","forEach","el","includes","request","values","mode","showBuyModal","product","department","showProductModal","searchField","find","length","on","e","currentTarget","val","toLowerCase","filter","closest","text","indexOf","value","item","removeClass","addClass","stopPropagation","data","getDepartment","productName","app","showModalWindow","modalContainer","hideModalWindow","registerBuyModalEvents","bind","companyForm","buyForm","registerBuyModalForms","validationEngine","validationEngineOptions","inputmask","updateCustomData","submit","formAlignmentAfterValidation","removeEmptyFilesInput","progressIndicatorElement","progressIndicator","blockInfo","enabled","AppConnector","url","type","formData","processData","contentType","done","success","priceBySize","customField","customFields","each","i","field","siblings","element"],"mappings":"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"}