'use strict';

jQuery.Class('Settings_QuickCreateEditor_Js',{},{updatedBlockSequence:{},updatedBlockFieldsList:[],showSaveButton:function showSaveButton(){var relatedList=jQuery('#relatedTabOrder'),saveButton=relatedList.find('.saveRelatedList');'disabled'==saveButton.attr('disabled')&&saveButton.removeAttr('disabled');},makeFieldsListSortable:function makeFieldsListSortable(){var thisInstance=this,contents=jQuery('#quickCreateEditorContainer').find('.contents');jQuery('#quickCreateEditorContainer .contents .editFieldsTable').each(function(){jQuery(this).find('ul[name=sortable1], ul[name=sortable2]').sortable({containment:'#moduleBlocks',revert:!0,tolerance:'pointer',cursor:'move',connectWith:jQuery(this).find('.connectedSortable'),update:function update(e,ui){if(thisInstance.showSaveFieldSequenceButton(),ui.sender){var olderBlock=ui.sender.closest('.editFieldsTable');thisInstance.reArrangeBlockFields(olderBlock);}}});});},showSaveFieldSequenceButton:function showSaveFieldSequenceButton(){var thisInstance=this,layout=jQuery('#detailViewLayout'),saveButton=layout.find('.saveFieldSequence');thisInstance.updatedBlockFieldsList=[],saveButton.removeClass('visibility');},hideSaveFieldSequenceButton:function hideSaveFieldSequenceButton(){var layout=jQuery('#detailViewLayout'),saveButton=layout.find('.saveFieldSequence');saveButton.addClass('visibility');},reArrangeBlockFields:function reArrangeBlockFields(block){var leftSideContainer=block.find('ul[name=sortable1]'),rightSideContainer=block.find('ul[name=sortable2]');if(leftSideContainer.children().length<rightSideContainer.children().length){var lastElementInRightContainer=rightSideContainer.children(':last');leftSideContainer.append(lastElementInRightContainer);}else if(leftSideContainer.children().length>rightSideContainer.children().length+1){var lastElementInLeftContainer=leftSideContainer.children(':last');rightSideContainer.append(lastElementInLeftContainer);}},createUpdatedBlockFieldsList:function createUpdatedBlockFieldsList(){var thisInstance=this,contents=jQuery('#quickCreateEditorContainer').find('.contents'),updatedBlock=contents.find('.block'),firstBlockSortFields=updatedBlock.find('ul[name=sortable1]'),tmpArray=[];firstBlockSortFields.each(function(i,domElement){var fieldEle=jQuery(domElement),eleAmount=fieldEle.find('.editFields').length;tmpArray.push(eleAmount);});var editFields=firstBlockSortFields.find('.editFields'),expectedFieldSequence=1;editFields.each(function(i,domElement){var fieldEle=jQuery(domElement),fieldId=fieldEle.data('fieldId');thisInstance.updatedBlockFieldsList.push({fieldid:fieldId,sequence:expectedFieldSequence}),expectedFieldSequence+=2,i==tmpArray[0]-1&&(expectedFieldSequence=1);});var secondBlockSortFields=updatedBlock.find('ul[name=sortable2]'),secondEditFields=secondBlockSortFields.find('.editFields'),sequenceValue=2;tmpArray=[],secondBlockSortFields.each(function(i,domElement){var fieldEle=jQuery(domElement),eleAmount=fieldEle.find('.editFields').length;tmpArray.push(eleAmount);}),secondEditFields.each(function(i,domElement){var fieldEle=jQuery(domElement),fieldId=fieldEle.data('fieldId');thisInstance.updatedBlockFieldsList.push({fieldid:fieldId,sequence:sequenceValue}),sequenceValue+=2,i==tmpArray[0]-1&&(sequenceValue=2);});},registerFieldSequenceSaveClick:function registerFieldSequenceSaveClick(){var thisInstance=this,layout=jQuery('#detailViewLayout');layout.on('click','.saveFieldSequence',function(){thisInstance.hideSaveFieldSequenceButton(),thisInstance.createUpdatedBlockFieldsList(),thisInstance.updateFieldSequence();});},updateFieldSequence:function updateFieldSequence(){var thisInstance=this,progressIndicatorElement=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}}),params={};params.module=app.getModuleName(),params.parent=app.getParentModuleName(),params.action='SaveSequenceNumber',params.mode='move',params.updatedFields=thisInstance.updatedBlockFieldsList,AppConnector.request(params).done(function(){progressIndicatorElement.progressIndicator({mode:'hide'}),Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate('JS_FIELD_SEQUENCE_UPDATED')});}).fail(function(){progressIndicatorElement.progressIndicator({mode:'hide'});});},avoidDropDownClick:function avoidDropDownClick(dropDownContainer){dropDownContainer.find('.dropdown-menu').on('click',function(e){e.stopPropagation();});},addClickOutSideEvent:function addClickOutSideEvent(element,callbackFunction){element.one('clickoutside',callbackFunction);},registerModulesChangeEvent:function registerModulesChangeEvent(){var thisInstance=this,container=jQuery('#quickCreateEditorContainer'),contentsDiv=container.closest('.contentsDiv');App.Fields.Picklist.showSelect2ElementView(container.find('[name="quickCreateEditorModules"]'),{dropdownCss:{"z-index":0}}),container.on('change','[name="quickCreateEditorModules"]',function(e){var currentTarget=jQuery(e.currentTarget),selectedModule=currentTarget.val();thisInstance.getModuleQuickCreateEditor(selectedModule).done(function(data){contentsDiv.html(data),thisInstance.registerEvents();});});},getModuleQuickCreateEditor:function getModuleQuickCreateEditor(selectedModule){var aDeferred=jQuery.Deferred(),progressIndicatorElement=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}}),params={};return params.module=app.getModuleName(),params.parent=app.getParentModuleName(),params.view='Index',params.sourceModule=selectedModule,AppConnector.requestPjax(params).done(function(data){progressIndicatorElement.progressIndicator({mode:'hide'}),aDeferred.resolve(data);}).fail(function(){progressIndicatorElement.progressIndicator({mode:'hide'}),aDeferred.reject();}),aDeferred.promise()},registerEvents:function registerEvents(){var thisInstance=this;thisInstance.registerModulesChangeEvent(),thisInstance.makeFieldsListSortable(),thisInstance.registerFieldSequenceSaveClick();}}),jQuery(document).ready(function(){var instance=new Settings_QuickCreateEditor_Js;instance.registerEvents();});
//# sourceMappingURL=QuickCreateEditor.min.js.map
