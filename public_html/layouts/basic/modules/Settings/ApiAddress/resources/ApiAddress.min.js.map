{"version":3,"file":"ApiAddress.min.js","sources":["ApiAddress.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\n\t'Settings_ApiAddress_Configuration_Js',\n\t{},\n\t{\n\t\tregisterSave: function(content) {\n\t\t\tcontent.find('.saveGlobal').on('click', event => {\n\t\t\t\tconst defaultProvider = $('[name=\"default_provider\"]:checked');\n\t\t\t\tlet elements = {\n\t\t\t\t\tglobal: {\n\t\t\t\t\t\tmin_length: $('[name=\"min_length\"]').val(),\n\t\t\t\t\t\tresult_num: $('[name=\"result_num\"]').val(),\n\t\t\t\t\t\tdefault_provider: defaultProvider.length ? defaultProvider.val() : 0\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\t$('[name=\"active\"]').each((i, e) => {\n\t\t\t\t\telements[e.dataset.type] = { active: e.checked ? 1 : 0 };\n\t\t\t\t});\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tmodule: 'ApiAddress',\n\t\t\t\t\t\tparent: 'Settings',\n\t\t\t\t\t\taction: 'SaveConfig',\n\t\t\t\t\t\telements: elements\n\t\t\t\t\t},\n\t\t\t\t\tasync: false,\n\t\t\t\t\tdataType: 'json'\n\t\t\t\t})\n\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\t\ttext: data['result']['message'],\n\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\t\ttext: app.vtranslate('JS_ERROR'),\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tregisterValidate: function(elements) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar status = true;\n\t\t\tfor (var i in elements) {\n\t\t\t\tif (i == 'min_length' || i == 'result_num') {\n\t\t\t\t\tif (!thisInstance.registerValidatemin_length(elements[i])) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (i == 'key') {\n\t\t\t\t\tif (!thisInstance.registerValidatekey(elements.key, elements.api_name)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn status;\n\t\t},\n\t\tregisterValidatemin_length: function(val) {\n\t\t\tvar filter = /^\\d+$/;\n\n\t\t\tif (!filter.test(val) || (1 == val || 0 == val)) {\n\t\t\t\tvar par = {\n\t\t\t\t\ttext: app.vtranslate('JS_WRONG_NUMBER'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t};\n\t\t\t\tVtiger_Helper_Js.showPnotify(par);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\tregisterValidatekey: function(val, apiName) {\n\t\t\tvar status = true;\n\n\t\t\tif ('opencage_data' == apiName) {\n\t\t\t\tvar test = 'https://api.opencagedata.com/geocode/v1/json?query=test&pretty=1&key=' + val;\n\t\t\t\tjQuery.ajax({\n\t\t\t\t\turl: test,\n\t\t\t\t\tasync: false,\n\t\t\t\t\tcomplete: function(data) {\n\t\t\t\t\t\tif (data.status == 403) {\n\t\t\t\t\t\t\tvar parametry = {\n\t\t\t\t\t\t\t\ttext: app.vtranslate('Invalid API key'),\n\t\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tVtiger_Helper_Js.showPnotify(parametry);\n\t\t\t\t\t\t\tstatus = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn status;\n\t\t},\n\t\tregisterConfigModal(container) {\n\t\t\tcontainer.find('.js-show-config-modal').on('click', e => {\n\t\t\t\tconst providerName = e.currentTarget.dataset.provider;\n\t\t\t\tapp.showModalWindow(\n\t\t\t\t\tnull,\n\t\t\t\t\t`index.php?module=ApiAddress&parent=Settings&view=ApiConfigModal&provider=${providerName}`,\n\t\t\t\t\tmodalContainer => {\n\t\t\t\t\t\tmodalContainer.find('.js-modal__save').on('click', _ => {\n\t\t\t\t\t\t\tlet elements = {};\n\t\t\t\t\t\t\tlet customField = modalContainer.find('.js-custom-field');\n\t\t\t\t\t\t\tcustomField.each((i, e) => {\n\t\t\t\t\t\t\t\telements[$(e).attr('name')] = e.value;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\telements = { [providerName]: elements };\n\t\t\t\t\t\t\tAppConnector.request({\n\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\tmodule: 'ApiAddress',\n\t\t\t\t\t\t\t\t\tparent: 'Settings',\n\t\t\t\t\t\t\t\t\taction: 'SaveConfig',\n\t\t\t\t\t\t\t\t\telements: elements\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tasync: false,\n\t\t\t\t\t\t\t\tdataType: 'json'\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\t\t\t\t\ttext: data['result']['message'],\n\t\t\t\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\t\t\t\t\ttext: app.vtranslate('JS_ERROR'),\n\t\t\t\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\tregisterEvents: function() {\n\t\t\tvar content = $('.contentsDiv');\n\t\t\tvar configTable = $('.js-config-table');\n\t\t\tthis.registerConfigModal(configTable);\n\t\t\tthis.registerSave(content);\n\t\t}\n\t}\n);\n"],"names":["jQuery","Class","registerSave","content","find","on","$","elements","global","min_length","val","result_num","default_provider","defaultProvider","length","each","i","e","dataset","type","active","checked","AppConnector","request","data","module","parent","action","async","dataType","done","Vtiger_Helper_Js","showPnotify","text","fail","app","vtranslate","registerValidate","registerValidatemin_length","filter","test","par","registerValidatekey","apiName","ajax","url","complete","status","parametry","registerConfigModal","container","currentTarget","provider","showModalWindow","providerName","modalContainer","customField","attr","value","window","location","reload","registerEvents","configTable"],"mappings":"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"}