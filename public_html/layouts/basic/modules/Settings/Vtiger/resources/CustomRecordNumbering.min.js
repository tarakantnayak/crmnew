'use strict';

$.Class('Settings_CustomRecordNumbering_Js',{},{form:!1,getForm:function getForm(){return !1==this.form&&(this.form=jQuery('#EditView')),this.form},registerOnChangeEventOfSourceModule:function registerOnChangeEventOfSourceModule(){var editViewForm=this.getForm();editViewForm.find('[name="sourceModule"]').on('change',function(e){$('.saveButton').removeAttr('disabled'),AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'CustomRecordNumberingAjax',mode:'getModuleCustomNumberingData',sourceModule:$(e.currentTarget).val()}).done(function(data){if(data){editViewForm.find('[name="prefix"]').val(data.result.prefix),editViewForm.find('[name="leading_zeros"]').val(data.result.leading_zeros).trigger('change'),editViewForm.find('[name="reset_sequence"]').val(data.result.reset_sequence).trigger('change'),editViewForm.find('[name="postfix"]').val(data.result.postfix),editViewForm.find('[name="sequenceNumber"]').val(data.result.cur_id),editViewForm.find('[name="sequenceNumber"]').data('oldSequenceNumber',data.result.cur_id);var options='';for(var index in data.result.picklists)options+='<option value="picklist:'+index+'">'+data.result.picklists[index]+'</option>';editViewForm.find('#picklistVariables').html(options);}});});},saveModuleCustomNumbering:function saveModuleCustomNumbering(){if(!$('.saveButton').attr('disabled')){var editViewForm=this.getForm(),sourceModule=editViewForm.find('[name="sourceModule"]').val(),prefix=editViewForm.find('[name="prefix"]'),leadingZeros=editViewForm.find('[name="leading_zeros"]').val(),currentPrefix=$.trim(prefix.val()),postfix=editViewForm.find('[name="postfix"]'),currentPostfix=jQuery.trim(postfix.val()),sequenceNumberElement=editViewForm.find('[name="sequenceNumber"]'),sequenceNumber=sequenceNumberElement.val(),oldSequenceNumber=sequenceNumberElement.data('oldSequenceNumber');return sequenceNumber<oldSequenceNumber&&currentPrefix===prefix.data('oldPrefix')&&currentPostfix===postfix.data('oldPostfix')?void sequenceNumberElement.validationEngine('showPrompt',app.vtranslate('JS_SEQUENCE_NUMBER_MESSAGE')+' '+oldSequenceNumber,'error','topLeft',!0):void(editViewForm.find('.saveButton').attr('disabled','disabled'),AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'CustomRecordNumberingAjax',mode:'saveModuleCustomNumberingData',sourceModule:sourceModule,prefix:currentPrefix,leading_zeros:leadingZeros,postfix:currentPostfix,sequenceNumber:sequenceNumber,reset_sequence:editViewForm.find('[name="reset_sequence"]').val()}).done(function(data){!0===data.success?Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate('JS_RECORD_NUMBERING_SAVED_SUCCESSFULLY_FOR')+' '+editViewForm.find('option[value="'+sourceModule+'"]').text()}):Settings_Vtiger_Index_Js.showMessage({text:currentPrefix+' '+app.vtranslate(data.error.message),type:'error'});}))}},registerEventToUpdateRecordsWithSequenceNumber:function registerEventToUpdateRecordsWithSequenceNumber(){var editViewForm=this.getForm();editViewForm.find('[name="updateRecordWithSequenceNumber"]').on('click',function(){var sourceModule=editViewForm.find('[name="sourceModule"]').val();AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'CustomRecordNumberingAjax',mode:'updateRecordsWithSequenceNumber',sourceModule:sourceModule}).done(function(data){!0===data.success?Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate('JS_RECORD_NUMBERING_UPDATED_SUCCESSFULLY_FOR')+' '+editViewForm.find('option[value="'+sourceModule+'"]').text()}):Settings_Vtiger_Index_Js.showMessage(data.error.message);});});},registerChangeEvent:function registerChangeEvent(){this.getForm().find('[name="prefix"],[name="leading_zeros"],[name="sequenceNumber"],[name="postfix"],[name="reset_sequence"]').on('change',this.checkPrefix.bind(this));},registerCopyClipboard:function registerCopyClipboard(editViewForm){new ClipboardJS('#customVariableCopy',{text:function text(){return Vtiger_Helper_Js.showPnotify({text:app.vtranslate('JS_NOTIFY_COPY_TEXT'),type:'success'}),'{{'+editViewForm.find('#customVariables').val()+'}}'}}),new ClipboardJS('#picklistVariableCopy',{text:function text(){return Vtiger_Helper_Js.showPnotify({text:app.vtranslate('JS_NOTIFY_COPY_TEXT'),type:'success'}),'{{'+editViewForm.find('#picklistVariables').val()+'}}'}});},checkPrefix:function checkPrefix(){var sequenceExists=!1,editViewForm=this.getForm(),value=editViewForm.find('[name="reset_sequence"]').val(),prefix=editViewForm.find('[name="prefix"]').val(),postfix=editViewForm.find('[name="postfix"]').val(),saveBtn=editViewForm.find('.saveButton');switch(value){case'Y':-1===prefix.indexOf('{{YY}}')&&-1===prefix.indexOf('{{YYYY}}')&&-1===postfix.indexOf('{{YY}}')&&-1===postfix.indexOf('{{YYYY}}')?(saveBtn.attr('disabled','disabled'),Vtiger_Helper_Js.showMessage({type:'error',text:app.vtranslate('JS_RS_ADD_YEAR_VARIABLE')})):(saveBtn.removeAttr('disabled'),sequenceExists=!0);break;case'M':-1===prefix.indexOf('{{MM}}')&&-1===prefix.indexOf('{{M}}')&&-1===postfix.indexOf('{{MM}}')&&-1===postfix.indexOf('{{M}}')?(saveBtn.attr('disabled','disabled'),Vtiger_Helper_Js.showMessage({type:'error',text:app.vtranslate('JS_RS_ADD_MONTH_VARIABLE')})):(saveBtn.removeAttr('disabled'),sequenceExists=!0);break;case'D':-1===prefix.indexOf('{{DD}}')&&-1===prefix.indexOf('{{D}}')&&-1===postfix.indexOf('{{DD}}')&&-1===postfix.indexOf('{{D}}')?(saveBtn.attr('disabled','disabled'),Vtiger_Helper_Js.showMessage({type:'error',text:app.vtranslate('JS_RS_ADD_DAY_VARIABLE')})):(saveBtn.removeAttr('disabled'),sequenceExists=!0);break;case'X':default:saveBtn.removeAttr('disabled'),sequenceExists=!0;}if(sequenceExists){var regex=/{{picklist:([a-z0-9_]+)}}/g,regexResult=(postfix+prefix).match(regex);regexResult&&1<regexResult.length?(Vtiger_Helper_Js.showMessage({type:'error',text:app.vtranslate('JS_PICKLIST_TOO_MANY')}),sequenceExists=!1,saveBtn.attr('disabled','disabled')):(saveBtn.removeAttr('disabled'),sequenceExists=!0);}return sequenceExists},registerEvents:function registerEvents(){var thisInstance=this,editViewForm=this.getForm();this.registerOnChangeEventOfSourceModule(),this.registerEventToUpdateRecordsWithSequenceNumber(),this.registerChangeEvent();var params=app.validationEngineOptions;params.onValidationComplete=function(editViewForm,valid){return valid&&thisInstance.saveModuleCustomNumbering(),!1},editViewForm.validationEngine('detach'),editViewForm.validationEngine('attach',params),this.registerCopyClipboard(editViewForm);}}),jQuery(document).ready(function(){var customRecordNumberingInstance=new Settings_CustomRecordNumbering_Js;customRecordNumberingInstance.registerEvents();});
//# sourceMappingURL=CustomRecordNumbering.min.js.map
