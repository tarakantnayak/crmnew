'use strict';

$.Class('Vtiger_PDF_Js',{validateSubmit:function validateSubmit(container){var templateIds=[],i=0;if(container.find('[name="pdf_template[]"]').each(function(){$(this).is(':checked')&&(templateIds[i]=$(this).val(),i++);}),0<templateIds.length){container.find('#generate_pdf').attr('disabled',!1);var view=app.getUrlVar('view');1<templateIds.length||view&&'List'===view.replace('#','')&&0<JSON.parse(container.find('[name="validRecords"]').val()).length?container.find('#single_pdf').show():container.find('#single_pdf').hide();}else container.find('#generate_pdf').attr('disabled',!0),container.find('#single_pdf').hide();},proceedSubmit:function proceedSubmit(templateIds,mode){var loader=$.progressIndicator({message:app.vtranslate('JS_PDF_GENERATING'),position:'html',blockInfo:{enabled:!0}});switch(this.container.find('[name="template"]').val(templateIds),mode){case'generate_pdf':break;case'single_pdf':this.container.find('[name="single_pdf"]').val(1),this.container.find('#pdfExportModal').submit();break;case'email_pdf':this.container.find('[name="email_pdf"]').val(1),this.container.find('#pdfExportModal').submit();}loader.progressIndicator({mode:'hide'}),app.hideModalWindow();},registerPreSubmitEvent:function registerPreSubmitEvent(container){var self=this;container.find('#generate_pdf, #single_pdf, #email_pdf').on('click',function(){var templateIds=[];container.find('[name="pdf_template[]"]').each(function(){$(this).is(':checked')&&templateIds.push($(this).val());});var view=app.getUrlVar('view');view&&'List'===view.replace('#','')&&container.find('[name="record"]').val(container.find('[name="validRecords"]').val()),self.proceedSubmit.apply(self,[templateIds,$(this).attr('id')]);});},registerValidateSubmit:function registerValidateSubmit(container){var _this=this;this.validateSubmit(container),container.find('[name="pdf_template[]"]').on('change',function(){_this.validateSubmit(container);});},registerListViewCheckRecords:function registerListViewCheckRecords(container){var thisInstance=this;container.find('[name="pdf_template[]"]').on('change',function(){var _this2=this;document.progressLoader=jQuery.progressIndicator({message:app.vtranslate('JS_PDF_RECALCULATING'),position:'html',blockInfo:{enabled:!0}});var selectedRecords=container.find('[name="selectedRecords"]').val(),selectedTemplates=[];container.find('[name="pdf_template[]"]:checked').each(function(){selectedTemplates.push($(_this2).val());});var params={};params.data={module:app.getModuleName(),action:'PDF',mode:'validateRecords',records:selectedRecords,view:app.getViewName(),templates:selectedTemplates},params.dataType='json',AppConnector.request(params).done(function(data){var response=data.result;data.success&&(container.find('[name="validRecords"]').val(JSON.stringify(response.valid_records)),container.find('#recordsInfo').text(response.message),setTimeout(function(){document.progressLoader.progressIndicator({mode:'hide'});},500),thisInstance.validateSubmit(container));}).fail(function(data,err){app.errorLog(data,err);});});},countSelectedRecords:function countSelectedRecords(container){return JSON.parse(container.find('[name="selectedRecords"]').val()).length},registerSelectCustomColumnsChange:function registerSelectCustomColumnsChange(){var _this3=this;this.container.find('[name="isCustomMode"]').on('change',function(ev){$(ev.target).is(':checked')?(_this3.container.find('[name="inventoryColumns[]"]').prop('disabled',null),_this3.container.find('.js-save-scheme').prop('disabled',null)):(_this3.container.find('[name="inventoryColumns[]"]').prop('disabled','disabled'),_this3.container.find('.js-save-scheme').prop('disabled','disabled'));});},registerSaveInventoryColumnSchemeClick:function registerSaveInventoryColumnSchemeClick(){var _this4=this;this.container.find('.js-save-scheme').on('click',function(e){e.preventDefault(),e.stopPropagation();var loader=$.progressIndicator({position:'html',blockInfo:{enabled:!0}}),records=JSON.parse(_this4.container.find('[name="selectedRecords"]').val()),record=parseInt(_this4.container.find('[name="record"]').val());record&&records.push(record),AppConnector.request({data:{module:app.getModuleName(),mode:'saveInventoryColumnScheme',action:'PDF',records:records,inventoryColumns:_this4.container.find('[name="inventoryColumns[]"]').val(),isCustomMode:_this4.container.find('[name="isCustomMode"]').is(':checked')},dataType:'json'}).done(function(data){var response=data.result;data.success&&loader.progressIndicator({mode:'hide'}),response.message&&data.success&&app.showNotify({text:response.message,type:'success'});}).fail(function(data,err){app.errorLog(data,err);});});},registerEvents:function registerEvents(){var container=this.container=$('div.modal-content');if(this.dynamicTemplatesCount=0,this.registerPreSubmitEvent(container),this.registerSaveInventoryColumnSchemeClick(),this.registerSelectCustomColumnsChange(),'Detail'===app.getViewName()&&this.registerValidateSubmit(container),'List'===app.getViewName()){this.validateSubmit(container),this.registerListViewCheckRecords(container);var selectedRecords=JSON.parse(container.find('#all_records').val()),recordsInput=container.find('[name="selectedRecords"]'),validInput=container.find('[name="validRecords"]');container.find('div.modal-body').append('<p id="recordsInfo">'+app.vtranslate('JS_RECORD_INFO'),+'</p>'),recordsInput.val(JSON.stringify(selectedRecords)),validInput.val(JSON.stringify(selectedRecords)),$('#recordsInfo').text(selectedRecords.length+' from '+selectedRecords.length+' are valid for chosen template.'),this.validateSubmit(container);}}}),$(function(){new Vtiger_PDF_Js().registerEvents();});
//# sourceMappingURL=PDF.min.js.map
