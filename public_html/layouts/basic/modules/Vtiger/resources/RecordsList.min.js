'use strict';

$.Class('Base_RecordsList_JS',{},{selectEvent:!1,listSearchInstance:!1,moduleName:!1,container:!1,setSelectEvent:function setSelectEvent(cb){this.selectEvent=cb;},getParams:function getParams(){var params={module:this.moduleName,view:this.container.data('view'),src_module:this.container.find('.js-parent-module').val(),src_record:this.container.find('.js-source-record').val(),src_field:this.container.find('.js-source-field').val(),related_parent_module:this.container.find('.js-related-parent-module').val(),related_parent_id:this.container.find('.js-related-parent-id').val(),page:this.container.find('.js-page-number').val(),orderby:this.container.find('.js-order-by').val(),sortorder:this.container.find('.js-sort-order').val(),multi_select:this.container.find('.js-multi-select').val(),totalCount:this.container.find('.js-total-count').val(),noOfEntries:this.container.find('.js-no-entries').val(),filterFields:JSON.parse(this.container.find('.js-filter-fields').val()),onlyBody:!0},searchValue=this.listSearchInstance.getAlphabetSearchValue();return params.search_params=JSON.stringify(this.listSearchInstance.getListSearchParams(!0)),'undefined'!=typeof searchValue&&0<searchValue.length&&(params.search_key=this.listSearchInstance.getAlphabetSearchField(),params.search_value=searchValue,params.operator='s'),params},loadRecordList:function loadRecordList(params){var _this=this,body=this.container.find('.js-modal-body'),aDeferred=$.Deferred(),progressIndicatorElement=$.progressIndicator({blockInfo:{enabled:!0,elementToBlock:body}});return AppConnector.request($.extend(this.getParams(),params)).done(function(responseData){progressIndicatorElement.progressIndicator({mode:'hide'}),body.html($(responseData).html()),_this.registerBasicEvents(),aDeferred.resolve(responseData);}).fail(function(textStatus,errorThrown){aDeferred.reject(textStatus,errorThrown),progressIndicatorElement.progressIndicator({mode:'hide'}),Vtiger_Helper_Js.showPnotify({text:app.vtranslate('JS_NOT_ALLOWED_VALUE'),type:'error'});}),aDeferred.promise()},registerHeadersClickEvent:function registerHeadersClickEvent(){var thisInstance=this;this.container.on('click','.js-change-order',function(e){e.preventDefault();var element=$(this);'undefined'==typeof element.data('nextOrder')||thisInstance.loadRecordList({orderby:element.data('name'),sortorder:element.data('nextOrder')});});},updatePagination:function updatePagination(countNumberRecords){var _this2=this,params=this.getParams();params.mode='getPagination',countNumberRecords&&(params.showTotalCount=!0),AppConnector.request(params).done(function(responseData){_this2.container.find('.js-pagination-container').html(responseData);var totalCount=_this2.container.find('.js-pagination-list').data('totalCount');totalCount&&_this2.container.find('.js-total-count').val(totalCount),_this2.registerPaginationEvents();});},registerPaginationEvents:function registerPaginationEvents(){var thisInstance=this;this.container.find('.js-next-page').on('click',function(){if(!$(this).hasClass('disabled')&&thisInstance.container.find('.js-no-entries').val()==thisInstance.container.find('.js-page-limit').val()){var pageNumber=thisInstance.container.find('.js-page-number'),nextPageNumber=parseInt(parseFloat(pageNumber.val()))+1;pageNumber.val(nextPageNumber),thisInstance.loadRecordList().done(function(){thisInstance.updatePagination();});}}),this.container.find('.js-page--previous').on('click',function(){var pageNumber=thisInstance.container.find('.js-page-number');if(1<pageNumber.val()){var nextPageNumber=parseInt(parseFloat(pageNumber.val()))-1;pageNumber.val(nextPageNumber),thisInstance.loadRecordList().done(function(){thisInstance.updatePagination();});}}),this.container.find('.js-page--set').on('click',function(){$(this).hasClass('disabled')||(thisInstance.container.find('.js-page-number').val($(this).data('id')),thisInstance.loadRecordList().done(function(){thisInstance.updatePagination();}));}),this.container.find('.js-count-number-records').on('click',function(){app.hidePopover($(this)),Vtiger_Helper_Js.showMessage({title:app.vtranslate('JS_LBL_PERMISSION'),text:app.vtranslate('JS_GET_PAGINATION_INFO'),type:'info'}),thisInstance.updatePagination(!0);}),this.container.find('.js-page--jump-drop-down').on('click','li',function(e){e.stopImmediatePropagation();}).on('keypress','.js-page-jump',function(e){if(13==e.which){e.stopImmediatePropagation();var element=$(this),response=Vtiger_WholeNumberGreaterThanZero_Validator_Js.invokeValidation(element);if('undefined'!=typeof response)element.validationEngine('showPrompt',response,'','topLeft',!0);else{element.validationEngine('hideAll');var pageNumber=thisInstance.container.find('.js-page-number'),currentPageNumber=pageNumber.val(),newPageNumber=parseInt($(this).val()),totalPages=parseInt(thisInstance.container.find('.js-page--total').text());if(newPageNumber>totalPages){var error=app.vtranslate('JS_PAGE_NOT_EXIST');return void element.validationEngine('showPrompt',error,'','topLeft',!0)}if(newPageNumber==currentPageNumber)return void Vtiger_Helper_Js.showMessage({text:app.vtranslate('JS_YOU_ARE_IN_PAGE_NUMBER')+' '+newPageNumber,type:'info'});pageNumber.val(newPageNumber),thisInstance.loadRecordList().done(function(){thisInstance.updatePagination();});}}});},registerListSearch:function registerListSearch(){this.listSearchInstance=YetiForce_ListSearch_Js.getInstance(this.container,!1,this,this.moduleName),this.listSearchInstance.setViewName('RecordsList');},registerListEvents:function registerListEvents(){var thisInstance=this,additional=1==this.container.find('.js-additional-informations').val();thisInstance.container.on('click','.js-select-row',function(e){if($(e.target).hasClass('js-select-checkbox')||$(e.target).hasClass('u-cursor-auto'))return !0;var data=$(this).data();if('true'===thisInstance.container.find('.js-multi-select').val()){var selected={};additional?(selected[data.id]=[],$(this).closest('tr').find('td[data-field]').each(function(index,field){field=$(field),selected[data.id].push({value:field.text(),field:field.data('field'),type:field.data('type')});})):selected[data.id]=data.name,thisInstance.selectEvent(selected,e);}else thisInstance.selectEvent(data,e);app.hideModalWindow(!1,thisInstance.container.parent().attr('id'));}),thisInstance.container.on('click','.js-selected-rows',function(e){var selected={};thisInstance.container.find('table tr.js-select-row .js-select-checkbox').each(function(index,element){if(element=$(element),!element.is(':checked'))return !0;var data=element.closest('tr').data();additional?(selected[data.id]=[],element.closest('tr').find('td[data-field]').each(function(index,field){field=$(field),selected[data.id].push({value:field.text(),field:field.data('field'),type:field.data('type')});})):selected[data.id]=data.name;}),0>=Object.keys(selected).length?Vtiger_Helper_Js.showPnotify({text:app.vtranslate('JS_PLEASE_SELECT_ONE_RECORD')}):(thisInstance.selectEvent(selected,e),app.hideModalWindow($(e.target).closest('.js-modal-container')));}),thisInstance.container.on('change','.js-hierarchy-records',function(){thisInstance.container.find('.js-related-parent-id').val(this.value),thisInstance.container.find('.js-total-count').val(''),thisInstance.container.find('.js-page-number').val(1),thisInstance.loadRecordList().done(function(){thisInstance.updatePagination();});}),thisInstance.container.on('click','.js-select-checkbox',function(){var parentElem,element;parentElem=element=$(this),'all'===element.data('type')&&(parentElem=element.closest('table').find('.js-select-checkbox[data-type="row"]')),element.is(':checked')?parentElem.prop('checked',!0).closest('tr').addClass('highlightBackgroundColor'):parentElem.prop('checked',!1).closest('tr').removeClass('highlightBackgroundColor');});},registerBasicEvents:function registerBasicEvents(){this.registerListSearch(),this.registerPaginationEvents();},registerEvents:function registerEvents(modalContainer){this.container=modalContainer,this.moduleName=this.container.data('module'),this.registerBasicEvents(),this.registerListEvents(),this.registerHeadersClickEvent();}});
//# sourceMappingURL=RecordsList.min.js.map
