{"version":3,"file":"TreeCategoryModal.min.js","sources":["TreeCategoryModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\n\t'Vtiger_TreeCategory_Js',\n\t{},\n\t{\n\t\tmodalContainer: false,\n\t\ttreeInstance: false,\n\t\ttreeData: false,\n\t\twindowParent: app.getWindowParent(),\n\t\tgetModalContainer: function() {\n\t\t\tif (this.modalContainer == false) {\n\t\t\t\tthis.modalContainer = jQuery('#modalTreeCategoryModal');\n\t\t\t}\n\t\t\treturn this.modalContainer;\n\t\t},\n\t\tgetRecords: function(container) {\n\t\t\tif (this.treeData == false && container !== 'undefined') {\n\t\t\t\tvar treeValues = container.find('#treePopupValues').val();\n\t\t\t\tthis.treeData = JSON.parse(treeValues);\n\t\t\t}\n\t\t\treturn this.treeData;\n\t\t},\n\t\tgenerateTree: function(container) {\n\t\t\tvar thisInstance = this;\n\t\t\tif (thisInstance.treeInstance == false) {\n\t\t\t\tthisInstance.treeInstance = container.find('#treePopupContents');\n\t\t\t\tlet plugins = ['search', 'category'];\n\t\t\t\tif (thisInstance.getRelationType() == '2') {\n\t\t\t\t\tplugins.push('checkbox');\n\t\t\t\t}\n\t\t\t\tif (thisInstance.getRelationType() == '1') {\n\t\t\t\t\tplugins.push('edit');\n\t\t\t\t}\n\t\t\t\tthisInstance.treeInstance.jstree(\n\t\t\t\t\t$.extend(\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcore: {\n\t\t\t\t\t\t\t\tdata: thisInstance.getRecords(),\n\t\t\t\t\t\t\t\tthemes: {\n\t\t\t\t\t\t\t\t\tname: 'proton',\n\t\t\t\t\t\t\t\t\tresponsive: true\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcheckbox: {\n\t\t\t\t\t\t\t\tthree_state: false\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tplugins: plugins\n\t\t\t\t\t\t},\n\t\t\t\t\t\tthisInstance.treeInstance.data('params')\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tgetRelationType: function() {\n\t\t\treturn this.getModalContainer()\n\t\t\t\t.find('#relationType')\n\t\t\t\t.val();\n\t\t},\n\t\tsearching: function(text) {\n\t\t\tthis.treeInstance.jstree(true).search(text);\n\t\t},\n\t\tregisterSearchEvent: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tvar valueSearch = $('#valueSearchTree');\n\t\t\tvar btnSearch = $('#btnSearchTree');\n\t\t\tvalueSearch.on('keypress', function(e) {\n\t\t\t\tif (e.which == 13) {\n\t\t\t\t\tthisInstance.searching(valueSearch.val());\n\t\t\t\t}\n\t\t\t});\n\t\t\tbtnSearch.on('click', function() {\n\t\t\t\tthisInstance.searching(valueSearch.val());\n\t\t\t});\n\t\t},\n\t\tregisterSaveRecords: function(container) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet ord = [],\n\t\t\t\tocd = [];\n\t\t\t$.each(thisInstance.getRecords(), function(index, value) {\n\t\t\t\tif (value.state && value.state.selected && value.attr === 'record') {\n\t\t\t\t\tord.push(value.record_id);\n\t\t\t\t}\n\t\t\t\tif (value.category && value.category.checked && value.attr !== 'record') {\n\t\t\t\t\tocd.push(value.record_id);\n\t\t\t\t}\n\t\t\t});\n\t\t\tcontainer.find('[name=\"saveButton\"]').on('click', function(e) {\n\t\t\t\tlet recordsToAdd = [],\n\t\t\t\t\tcategoryToAdd = [],\n\t\t\t\t\trecordsToRemove = Object.assign([], ord),\n\t\t\t\t\tcategoryToRemove = Object.assign([], ocd);\n\t\t\t\tlet saveButton = $(this);\n\t\t\t\tsaveButton.attr('disabled', 'disabled');\n\t\t\t\tlet cSelected = thisInstance.treeInstance.jstree('getCategory', true);\n\t\t\t\t$.each(cSelected, function(index, treeElement) {\n\t\t\t\t\tlet value = treeElement.record_id;\n\t\t\t\t\tif (treeElement.attr === 'record') {\n\t\t\t\t\t\tif (jQuery.inArray(value, recordsToRemove) == -1) {\n\t\t\t\t\t\t\trecordsToAdd.push(value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trecordsToRemove.splice(recordsToRemove.indexOf(value), 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (treeElement.attr !== 'record') {\n\t\t\t\t\t\tif (jQuery.inArray(value, categoryToRemove) == -1) {\n\t\t\t\t\t\t\tcategoryToAdd.push(value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcategoryToRemove.splice(categoryToRemove.indexOf(value), 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlet params = {\n\t\t\t\t\tmodule: thisInstance.windowParent.app.getModuleName(),\n\t\t\t\t\taction: 'RelationAjax',\n\t\t\t\t\tmode: 'updateRelation',\n\t\t\t\t\trecordsToAdd: recordsToAdd,\n\t\t\t\t\trecordsToRemove: recordsToRemove,\n\t\t\t\t\tcategoryToAdd: categoryToAdd,\n\t\t\t\t\tcategoryToRemove: categoryToRemove,\n\t\t\t\t\tsrc_record: thisInstance.windowParent.app.getRecordId(),\n\t\t\t\t\trelated_module: container.find('#relatedModule').val()\n\t\t\t\t};\n\t\t\t\tif (recordsToAdd.length > 4) {\n\t\t\t\t\tbootbox.dialog({\n\t\t\t\t\t\ttitle: app.vtranslate('JS_INFORMATION'),\n\t\t\t\t\t\tmessage: app.vtranslate('JS_SAVE_SELECTED_ITEMS_ALERT').replace('__LENGTH__', recordsToAdd.length),\n\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\t\tlabel: app.vtranslate('JS_LBL_SAVE'),\n\t\t\t\t\t\t\t\tclassName: 'btn-success',\n\t\t\t\t\t\t\t\tcallback: function() {\n\t\t\t\t\t\t\t\t\tthisInstance.saveRecordsEvent(params);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdanger: {\n\t\t\t\t\t\t\t\tlabel: app.vtranslate('JS_LBL_CANCEL'),\n\t\t\t\t\t\t\t\tclassName: 'btn-warning',\n\t\t\t\t\t\t\t\tcallback: function() {\n\t\t\t\t\t\t\t\t\tsaveButton.removeAttr('disabled');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthisInstance.saveRecordsEvent(params);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tsaveRecordsEvent: function(params) {\n\t\t\tconst self = this;\n\t\t\tAppConnector.request(params).done(function(res) {\n\t\t\t\tself.windowParent.Vtiger_Detail_Js.getInstance().reloadTabContent();\n\t\t\t\tapp.hideModalWindow();\n\t\t\t});\n\t\t},\n\t\tregisterCounterSelected: function() {\n\t\t\tvar thisInstance = this;\n\t\t\tthis.treeInstance.on('changed.jstree', function(e, data) {\n\t\t\t\tvar counterSelected = 0;\n\t\t\t\tvar html = '';\n\t\t\t\t$.each(thisInstance.treeInstance.jstree('get_selected', true), function(index, value) {\n\t\t\t\t\tvar id = value.original.record_id.toString();\n\t\t\t\t\tif (id.indexOf('T')) {\n\t\t\t\t\t\tcounterSelected++;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\thtml = app.vtranslate('JS_SELECTED_ELEMENTS') + ': ' + counterSelected;\n\t\t\t\t$('.counterSelected').text(html);\n\t\t\t});\n\t\t},\n\t\tregisterEvents: function() {\n\t\t\tvar container = this.getModalContainer();\n\t\t\tthis.getRecords(container);\n\t\t\tthis.generateTree(container);\n\t\t\tthis.registerSaveRecords(container);\n\t\t\tthis.registerSearchEvent();\n\t\t\tthis.registerCounterSelected();\n\t\t}\n\t}\n);\njQuery(function() {\n\tvar instance = new Vtiger_TreeCategory_Js();\n\tinstance.registerEvents();\n});\n"],"names":["jQuery","Class","modalContainer","treeInstance","treeData","windowParent","app","getWindowParent","getModalContainer","getRecords","container","find","val","JSON","parse","treeValues","generateTree","thisInstance","getRelationType","plugins","push","jstree","$","extend","core","data","themes","name","responsive","checkbox","three_state","searching","text","search","registerSearchEvent","valueSearch","btnSearch","on","e","which","registerSaveRecords","ord","ocd","each","index","value","state","selected","attr","record_id","category","checked","categoryToAdd","recordsToRemove","Object","assign","categoryToRemove","saveButton","cSelected","treeElement","inArray","recordsToAdd","splice","indexOf","module","getModuleName","action","mode","src_record","getRecordId","related_module","length","bootbox","dialog","title","vtranslate","message","replace","buttons","success","label","className","callback","saveRecordsEvent","params","danger","removeAttr","AppConnector","request","done","self","Vtiger_Detail_Js","getInstance","reloadTabContent","hideModalWindow","registerCounterSelected","html","original","toString","id","counterSelected","registerEvents","instance"],"mappings":"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"}