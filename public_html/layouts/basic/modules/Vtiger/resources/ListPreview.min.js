'use strict';

Vtiger_List_Js('Vtiger_ListPreview_Js',{},{frameProgress:!1,updatePreview:function updatePreview(url){var frame=$('.listPreviewframe');this.frameProgress=$.progressIndicator({position:'html',message:app.vtranslate('JS_FRAME_IN_PROGRESS'),blockInfo:{enabled:!0}});var defaultView='';app.getMainParams('defaultDetailViewName')&&(defaultView=defaultView+'&mode=showDetailViewByMode&requestMode='+app.getMainParams('defaultDetailViewName')),frame.attr('src',url.replace('view=Detail','view=DetailPreview')+defaultView);},registerRowClickEvent:function registerRowClickEvent(){var thisInstance=this,listViewContentDiv=this.getListViewContentContainer();listViewContentDiv.on('click','.listViewEntries',function(e){if(!$(e.target).closest('div').hasClass('actions')&&!($(e.target).is('button')||$(e.target).parent().is('button'))&&!$(e.target).closest('a').hasClass('noLinkBtn')&&!$(e.target,$(e.currentTarget)).is('td:first-child')&&!$(e.target).is('input[type="checkbox"]')&&!$.contains($(e.currentTarget).find('td:last-child').get(0),e.target)&&!$.contains($(e.currentTarget).find('td:first-child').get(0),e.target)){var elem=$(e.currentTarget),recordUrl=elem.data('recordurl');'undefined'==typeof recordUrl||($('.listViewEntriesTable .listViewEntries').removeClass('active'),$(this).addClass('active'),thisInstance.updatePreview(recordUrl));}});},registerListEvents:function registerListEvents(container){var _this=this,listPreview=container.find('.js-detail-preview'),mainBody=container.closest('.mainBody'),commActHeight=$('.commonActionsContainer').height();app.showNewScrollbarTopBottomRight(this.list,{wheelPropagation:!1}),this.registerFixedThead(),mainBody.scrollTop(0),$(window).on('resize',function(){mainBody.scrollTop()>=_this.list.offset().top+commActHeight&&container.find('.gutter').css('left',listPreview.offset().left-8);});var listOffsetTop=this.list.offset().top-this.headerH,initialH=this.sideBlocks.height(),mainViewPortHeightCss={height:mainBody.height()},mainViewPortWidthCss={width:mainBody.height()};this.gutter.addClass('js-fixed-scroll');var fixedElements=container.find('.js-fixed-scroll'),fixedThead=this.list.siblings('.floatThead-container');mainBody.on('scroll',function(){mainBody.scrollTop()>=listOffsetTop?(fixedThead.add(fixedElements).css({top:mainBody.scrollTop()-listOffsetTop}),fixedElements.css(mainViewPortHeightCss),_this.rotatedText.css(mainViewPortHeightCss),_this.rotatedText.css(mainViewPortWidthCss)):(fixedThead.add(fixedElements).css({top:'initial'}),fixedElements.css({height:initialH+mainBody.scrollTop()}),_this.rotatedText.css({width:initialH+mainBody.scrollTop(),height:initialH+mainBody.scrollTop()}));}),this.list.on('click','.listViewEntries',function(){if(10>_this.split.getSizes()[1]){var defaultGutterPosition=_this.getDefaultSplitSizes();_this.split.setSizes(defaultGutterPosition),listPreview.show(),_this.sideBlockRight.removeClass('d-block'),app.moduleCacheSet('userSplitSet',defaultGutterPosition);}});},registerFixedThead:function registerFixedThead(){var list=this.list;this.listFloatThead=list.find('.js-fixed-thead'),this.listFloatThead.floatThead('destroy'),this.listFloatThead.floatThead({scrollContainer:function scrollContainer(){return list}}),this.listFloatThead.floatThead('reflow');},getSecondColMinWidth:function getSecondColMinWidth(container){var thisWidth,maxWidth=0;return container.find('.listViewEntries').each(function(i){thisWidth=$(this).find('.listViewEntryValue a').first().width(),0===i?maxWidth=thisWidth:thisWidth>maxWidth?maxWidth=thisWidth:maxWidth;}),maxWidth},getDomParams:function getDomParams(container){this.listColumnFirstWidth=container.find('.listViewEntriesDiv .listViewHeaders th').first().width(),this.listColumnSecondWidth=this.getSecondColMinWidth(container),this.windowMinWidth=100*(15/$(window).width()),this.windowMaxWidth=100-this.minWidth,this.sideBlocks=container.find('.js-side-block'),this.sideBlockLeft=this.sideBlocks.first(),this.sideBlockRight=this.sideBlocks.last(),this.list=container.find('.js-list-preview'),this.rotatedText=container.find('.u-rotate-90'),this.footerH=$('.js-footer').outerHeight(),this.headerH=$('.js-header').outerHeight();},getDefaultSplitSizes:function getDefaultSplitSizes(){var thWidth=100*((this.listColumnFirstWidth+this.listColumnSecondWidth+82)/$(window).width());return [thWidth,100-thWidth]},getSplitSizes:function getSplitSizes(){var cachedParams=app.moduleCacheGet('userSplitSet');return void 0===cachedParams?this.getDefaultSplitSizes():cachedParams},registerSplitEvents:function registerSplitEvents(container,split){var _this2=this,rightSplitMaxWidth=100*(400/$(window).width()),minWindowWidth=100*(25/$(window).width()),listPreview=container.find('.js-detail-preview');this.gutter.on('dblclick',function(){var gutterMidPosition=app.moduleCacheGet('gutterMidPosition');isNaN(_this2.split.getSizes()[0])&&_this2.split.setSizes(gutterMidPosition),10>split.getSizes()[0]?(_this2.sideBlockLeft.removeClass('d-block'),_this2.list.removeClass('u-hide-underneath'),11<gutterMidPosition[0]?split.setSizes(gutterMidPosition):split.setSizes(_this2.getDefaultSplitSizes())):20>split.getSizes()[1]?(gutterMidPosition[1]>rightSplitMaxWidth+1?split.setSizes(gutterMidPosition):split.setSizes(_this2.getDefaultSplitSizes()),_this2.sideBlockRight.removeClass('d-block'),listPreview.show(),_this2.gutter.css('right','initial')):10<split.getSizes()[0]&&50>split.getSizes()[0]?(split.setSizes([minWindowWidth,100-minWindowWidth]),_this2.list.addClass('u-hide-underneath'),_this2.sideBlockLeft.addClass('d-block')):10<split.getSizes()[1]&&50>split.getSizes()[1]&&(split.collapse(1),_this2.sideBlockRight.addClass('d-block'),listPreview.hide(),_this2.list.width(_this2.list.width()-10)),app.moduleCacheSet('userSplitSet',split.getSizes());}),this.sideBlockLeft.on('click',function(){var gutterMidPosition=app.moduleCacheGet('gutterMidPosition');11<gutterMidPosition[0]?split.setSizes(gutterMidPosition):split.setSizes(_this2.getDefaultSplitSizes()),_this2.sideBlockLeft.removeClass('d-block'),_this2.list.removeClass('u-hide-underneath'),app.moduleCacheSet('userSplitSet',split.getSizes());}),this.sideBlockRight.on('click',function(){var gutterMidPosition=app.moduleCacheGet('gutterMidPosition');gutterMidPosition[1]>rightSplitMaxWidth+1?split.setSizes(gutterMidPosition):split.setSizes(_this2.getDefaultSplitSizes()),_this2.sideBlockRight.removeClass('d-block'),listPreview.show(),_this2.gutter.css('right','initial'),app.moduleCacheSet('userSplitSet',split.getSizes());});},registerSplit:function registerSplit(container){var _this3=this,rightSplitMaxWidth=100*(400/$(window).width()),splitMinWidth=100*(25/$(window).width()),splitMaxWidth=100-splitMinWidth,listPreview=container.find('.js-detail-preview'),splitSizes=this.getSplitSizes(),split=Split([this.list[0],listPreview[0]],{sizes:splitSizes,minSize:10,gutterSize:24,snapOffset:100,onDrag:function onDrag(){split.getSizes()[1]<rightSplitMaxWidth&&split.collapse(1),5>split.getSizes()[0]?(_this3.sideBlockLeft.addClass('d-block'),_this3.list.addClass('u-hide-underneath')):(_this3.sideBlockLeft.removeClass('d-block'),_this3.list.removeClass('u-hide-underneath')),10>split.getSizes()[1]?(_this3.sideBlockRight.addClass('d-block'),listPreview.hide(),_this3.list.width(_this3.list.width()-10)):(_this3.sideBlockRight.removeClass('d-block'),listPreview.show()),10<split.getSizes()[0]&&split.getSizes()[1]>rightSplitMaxWidth&&app.moduleCacheSet('gutterMidPosition',split.getSizes()),_this3.listFloatThead.floatThead('reflow'),app.moduleCacheSet('userSplitSet',split.getSizes());}});10>splitSizes[0]?(listPreview.width(listPreview.width()-150),this.sideBlockLeft.addClass('d-block'),split.setSizes([splitMinWidth,splitMaxWidth]),this.list.addClass('u-hide-underneath')):splitSizes[1]<rightSplitMaxWidth&&(this.sideBlockRight.addClass('d-block'),listPreview.hide(),split.setSizes([splitMaxWidth,splitMinWidth])),this.gutter=container.find('.gutter');var mainWindowHeightCss={height:$(window).height()-(this.gutter.offset().top+this.footerH)};return this.gutter.css(mainWindowHeightCss),this.list.css(mainWindowHeightCss),this.sideBlocks.css(mainWindowHeightCss),this.registerSplitEvents(container,split),this.rotatedText.first().find('.js-list-name').append($('.breadcrumbsContainer .js-text-content').text()),this.rotatedText.css({width:this.sideBlockLeft.height(),height:this.sideBlockLeft.height()}),split},toggleSplit:function toggleSplit(container){var _this4=this,thisInstance=this,listPreview=container.find('.js-detail-preview'),splitsArray=[],mainBody=container.closest('.mainBody');993<$(window).width()&&!container.find('.gutter').length&&(this.split=thisInstance.registerSplit(container),splitsArray.push(this.split)),$(window).on('resize',function(){if(993>$(window).width())container.find('.gutter').length&&(splitsArray[splitsArray.length-1].destroy(),_this4.sideBlockRight.removeClass('d-block'),_this4.sideBlockLeft.removeClass('d-block'));else{1!==container.find('.gutter').length&&(_this4.split=thisInstance.registerSplit(container),_this4.gutter=container.find('.gutter'),_this4.gutter.addClass('js-fixed-scroll'),mainBody.scrollTop()>=_this4.list.offset().top&&(gutter.addClass('gutterOnScroll'),gutter.css('left',listPreview.offset().left-8),gutter.on('mousedown',function(){$(this).on('mousemove',function(){$(this).css('left',listPreview.offset().left-8);});})),splitsArray.push(_this4.split));var currentSplit=splitsArray[splitsArray.length-1];if('undefined'==typeof currentSplit)return;currentSplit.getSizes()[0]<_this4.windowMinWidth+5?currentSplit.setSizes([_this4.windowMinWidth,_this4.windowMaxWidth]):currentSplit.getSizes()[1]<_this4.windowMinWidth+5&&currentSplit.setSizes([_this4.windowMaxWidth,_this4.windowMinWidth]);}});},registerDesktopEvents:function registerDesktopEvents(){},registerPreviewEvent:function registerPreviewEvent(){var _this5=this,iframe=$('.listPreviewframe'),container=this.getListViewContentContainer();this.getDomParams(container),this.toggleSplit(container),993<$(window).width()&&this.registerListEvents(container),iframe.on('load',function(){_this5.frameProgress.progressIndicator({mode:'hide'}),iframe.height(iframe.contents().find('.bodyContents').height()-20);}),$('.listViewEntriesTable .listViewEntries').first().trigger('click');},updateWindowHeight:function updateWindowHeight(height,frame){frame.height(height);},postLoadListViewRecordsEvents:function postLoadListViewRecordsEvents(container){this._super(container),this.registerPreviewEvent();},registerEvents:function registerEvents(){this._super(),this.registerPreviewEvent();}});
//# sourceMappingURL=ListPreview.min.js.map
